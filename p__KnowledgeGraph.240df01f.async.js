(self.webpackChunkrapex_studio=self.webpackChunkrapex_studio||[]).push([[344],{76381:function(Ea,xt,u){"use strict";u.r(xt),u.d(xt,{default:function(){return Ni}});var un=u(13062),q=u(71230),xe=u(57663),W=u(71577),we=u(89032),be=u(15746),y=u(2824),Kt=u(22325),St=u(20228),Ht=u(11382),Zt=u(66456),He=u(15885),bt=u(13254),Ee=u(14277),Ct=u(22385),qe=u(94199),jt=u(18106),ve=u(63885),Nt=u(34792),K=u(48086),kt=u(71153),Oe=u(60331),wt=u(71194),st=u(50146),m=u(11849),Et=u(93224),de=u(86582),s=u(67294),et=u(53110),fn=u(57119),dt=u(21444),Pt=u(38296),tt=u(24616),$t=u(90841),ct=u(62298),It=u(19671),Tt=u(57338),H=u(273),e=u(85893),le=function(t){var a=t.position,n=t.onClick,o=(0,s.useState)(!1),r=(0,y.Z)(o,2),i=r[0],l=r[1];(0,s.useEffect)(function(){t.visible&&l(t.visible)},[t.visible]);var d=function(){t.onClose&&t.onClose(),l(!i)},f={right:{right:"0px",top:"45%",height:"80px",width:"38px",borderColor:"transparent #ddd transparent transparent"},top:{top:"0px",left:"45%",width:"80px",height:"38px",borderColor:"#ddd transparent transparent transparent"},left:{left:"0px",top:"45%",height:"80px",width:"38px",borderColor:"transparent transparent transparent #ddd"},bottom:{left:"45%",bottom:"0px",width:"80px",height:"38px",borderColor:"transparent transparent #ddd transparent"}},x={right:{left:"5px",top:"8px"},top:{top:"-20px",left:"40%"},bottom:{left:"15px",top:"0px"},left:{left:"-15px",top:"8px"}},S=a||"right",j=f[S]?f[S]:f.right,v=x[S]?x[S]:x.right;return(0,e.jsxs)("div",{className:"toolbar",children:[(0,e.jsx)("div",{style:(0,m.Z)({zIndex:10,position:"absolute",cursor:"pointer",borderStyle:"solid",borderWidth:"20px"},j),onClick:function(){console.log("Show Drawer: ",S),d(),n&&n(S)},children:(0,e.jsx)("span",{style:(0,m.Z)({position:"absolute"},v),children:S==="top"||S==="bottom"?"=":"||"})}),(0,e.jsx)(H.Z,{width:t.width?t.width:"300px",height:t.height?t.height:"300px",title:t.title?t.title:!1,getContainer:!1,style:{position:"absolute"},closable:t.closable?t.closable:!1,mask:t.maskVisible?t.maskVisible:!1,placement:a,onClose:d,open:i,children:i?t.children:null})]})},ee=le,N=u(96486),hn=u(77576),me=u(12028),vl=u(98858),Dt=u(4914),$e=u(91220),pl=u(43358),Ze=u(34041),gl=u(30887),vn=u(18515),Pa=u(42134),Mt=u(82735),Fe=u(98818),Pe=u(36950),pn=(0,s.createContext)({}),ml=u(20136),gn=u(55241),Ia=u(29154),Ta=u(84387),Da=u(54549),Ma=function(t){var a=(0,s.useRef)(null),n=(0,s.useRef)(null);return(0,s.useEffect)(function(){if(n.current){var o=n.current;o.addEventListener("click",function(){console.log("Focus the explanation panel"),o.style.zIndex="10";for(var r=document.getElementsByClassName("explanation-panel"),i=0;i<r.length;i++){var l=r[i];l!==o&&(l.style.zIndex="2")}})}},[n.current]),(0,e.jsxs)("div",{className:"explanation-panel",ref:n,style:{top:t.top||"200px",right:t.right||t.width||"400px"},children:[(0,e.jsxs)("div",{ref:a,style:{position:"absolute",width:t.width||"400px",maxWidth:"auto",maxHeight:"auto"},className:"explanation-content",children:[(0,e.jsxs)("div",{className:"explanation-title",children:[(0,e.jsx)("h3",{children:t.title||"Explanation"}),t.help?(0,e.jsx)(gn.Z,{content:t.help,title:"Help",placement:"topRight",children:(0,e.jsx)(Ta.Z,{})}):null,t.onClose?(0,e.jsx)(Da.Z,{className:"explanation-close",onClick:function(){var r;(r=t.onClose)===null||r===void 0||r.call(t)}}):null]}),(0,e.jsx)("div",{className:"explanation-info",children:t.children})]}),(0,e.jsx)(Ia.ZP,{target:a,draggable:!0,throttleDrag:1,edgeDraggable:!1,startDragRotate:0,throttleDragRotate:0,onDrag:function(r){r.target.style.transform=r.transform},resizable:!0,keepRatio:!1,throttleResize:1,renderDirections:["nw","n","ne","w","e","sw","s","se"],onResize:function(r){r.target.style.width="".concat(r.width,"px"),r.target.style.height="".concat(r.height,"px"),r.target.style.transform=r.drag.transform}})]})},Gt=Ma,Ot=u(4714),Ga=u(49346),je=u(50651),mn=u(40847),Oa=u(55076),yn=u(57820),La=u(43396),xn=u(20015),Qt=u(93181),Ra=u(7364),Sn=u(1870),Aa=u(71938),Fa=u(62876),za=u(73218),Va=u(43587),Lt=u(33182),Ba=u(93695),Zn=u(95357),Rt=u(82738),Ua=u(90631),Wa=u(73171),Ka=function(t){var a=t.data,n=t.style,o=a.map(function(r,i){return(0,e.jsx)(Dt.Z.Item,{label:r[0],children:r[1]},i)});return o.length>0?(0,e.jsx)(Dt.Z,{size:"small",column:2,title:null,labelStyle:{backgroundColor:"transparent"},bordered:!0,style:(0,m.Z)({},n),children:o}):(0,e.jsx)("span",{style:n,children:"No Properties"})},Ha=Ka,Ce=u(67569),Ue=u(81209),bn=function(t,a){var n=[];t.map(function(l){n=n.concat(Object.keys(l))});var o=[],r=(0,N.uniq)(n),i=(0,N.filter)(r,function(l){return a.indexOf(l)<0});return i.map(function(l){o.push({title:Ue.Z.titleCase(l),key:l,dataIndex:l,align:"center",ellipsis:!0})}),o},Cn=function(t){return t.map(function(a){return jn(a)})},_t=function(t,a){var n={},o=Object.keys(t),r=(0,N.filter)(o,function(i){return a?a.indexOf(i)<0:!0});return r.forEach(function(i){["string","number","boolean"].indexOf(typeof t[i])>=0&&(n[i]=t[i])}),n},jn=function(t,a){return t.data?(0,m.Z)((0,m.Z)({},_t(t,a)),_t(t.data,a)):_t(t)};function Nn(c,t,a){console.log("makeQueryStr filter: ",a);var n=":select [:*]",o="",r="";if(t){var i=Object.keys(t)[0],l=Object.values(t)[0];i&&l&&(l==="ascend"?o=":order-by [:".concat(i,"]"):o=":order-by [[:".concat(i," :desc]]"))}if(c){for(var d=[],f=0,x=Object.keys(c);f<x.length;f++){var S=x[f];["current","pageSize"].indexOf(S)<0&&c[S].length>0&&d.push("[:like [:upper :".concat(S,'] [:upper "%').concat(c[S],'%"]]'))}d.length==1?r=":where ".concat(d[0]):d.length>1&&(r=":where [:or ".concat(d.join(" "),"]"))}return"{".concat(n," ").concat(o," ").concat(r,"}")}function Te(c,t,a,n){var o=a||"n,m,r",r={match:c,where:t,return:o};return n!==void 0&&(r=(0,m.Z)((0,m.Z)({},r),{},{limit:n||50})),r}var yl=function(t){var a=t.filter(function(o){return o}),n={match:"(n)",where:"ID(n) in [".concat(a,"]"),return:"n"};return new Promise(function(o,r){postNodes({query_map:n}).then(function(i){i?o(i):r(i)}).catch(function(i){r(i)})})};function $a(c){var t=c.map(function(r){return{id:parseInt(r.id),label:r.nlabel}}),a=JSON.stringify(t,null).replace(/"([^"]+)":/g,"$1:"),n=JSON.stringify(c.map(function(r){return parseInt(r.id)}),null),o={with:"".concat(a," as nodeList, ").concat(n," as idList"),unwind:"nodeList AS node",match:"(n)-[r]-(m)",where:"node.label in labels(n) and ID(n) = node.id and ID(m) in idList",return:"n,m,r"};return new Promise(function(r,i){(0,Ce.zV)({query_map:o}).then(function(l){l?r(l):i(l)}).catch(function(l){i(l)})})}var kn=function(){return"<>"},wn=function(t,a,n,o){var r=kn();return t.indexOf("::")>=0?t:[t,a,n,o].join(r)};function En(c){for(var t=[],a=kn(),n=0;n<c.length;n++){var o=c[n].split(a),r=(0,y.Z)(o,4),i=r[0],l=r[1],d=r[2],f=r[3],x={relationshipType:i,sourceNodeType:d,targetNodeType:f,resource:l};t.push(x)}return t}var Pn=function(t){var a=0;return t.forEach(function(n){var o=n.toString().length;o>a&&(a=o)}),a},Qa=function(t){var a=[],n=Pn(t.map(function(o){return o.relation_count}));return t.forEach(function(o){var r=o.relation_count.toString().padStart(n,"0"),i=wn(o.relation_type,o.source,o.start_node_type,o.end_node_type);a.push({order:o.relation_count,label:"[".concat(r,"] ").concat(i),value:i})}),a.sort(function(o,r){return o.order-r.order})},In=function(t){var a=t.mode,n=t.node_type,o=t.node_id;return!!(a=="node"&&n&&o)},Tn=function(t){var a=t.mode,n=t.node_ids;return!!(a=="batchIds"&&n&&n.length>0)},Dn=function(t){var a=t.mode,n=t.node_id,o=t.node_type;return!!(a=="similarity"&&n&&o)},Mn=function(t){var a=t.mode,n=t.nodes,o=t.node_type;return!!(a=="batchNodes"&&n&&n.length>0&&o)},Gn=function(t){var a=t.mode,n=t.nodes;return!!(a=="path"&&n&&n.length>0)},_a=function(t){return!!(In(t)||Tn(t)||Dn(t)||Mn(t)||Gn(t))};function Ya(c){console.log("makeGraphQueryStrWithSearchObject: ",c);var t=c.node_type,a=c.node_id,n=c.relation_types,o=c.all_relation_types,r=c.enable_prediction,i=c.limit,l=c.mode,d=c.node_ids,f=c.topk,x=c.nodes;return new Promise(function(S,j){var v={},b={},g=i||50;if(l=="node"||l=="batchIds"||l=="batchNodes"||l=="path"){if(In(c))if(b=Te("(n:".concat(t,")-[r]-(m)"),"n.id = '".concat(a,"'"),void 0,g),!n||(n==null?void 0:n.length)==0){c.nsteps&&c.nsteps<=1?b=Te("(n:".concat(t,")-[r]-(m)"),"n.id = '".concat(a,"'"),void 0,g):b=Te("(n:".concat(t,")-[r*1..").concat(c.nsteps,"]-(m)"),"n.id = '".concat(a,"'"),"n,r,m",g);var Z=o?o.filter(function(R){return R.match(t||"")}):[],E=En(Z),k=E.map(function(R){return"'".concat(R.relationshipType,"'")});v={source_id:"".concat(a),relation_types:k,topk:10,enable_prediction:r}}else{var D=En(n),C=D.filter(function(R){return R.targetNodeType}),O="";if(C.length>0){var _=(0,N.uniq)(D.map(function(R){return"m:".concat(R.targetNodeType)})).join(" or ");O=_?"( ".concat(_," ) and "):""}var M=D.filter(function(R){return R.resource}),I="";if(M.length>0){var L=(0,N.uniq)(D.map(function(R){return"'".concat(R.resource,"'")})).join(",");I=L?"r.resource in [".concat(L,"] and "):""}var B=(0,N.uniq)(D.map(function(R){return R.relationshipType})),U=B.map(function(R){return"type(r) = '".concat(R,"'")}).join(" or "),$=U?"( ".concat(U," )"):"",se="".concat(O," ").concat(I," ").concat($);c.nsteps&&c.nsteps<=1?b=Te("(n:".concat(t,")-[r]-(m)"),"n.id = '".concat(a,"' and ").concat(se),void 0,g):b=Te("(n:".concat(t,")-[r*1..").concat(c.nsteps,"]-(m)"),"n.id = '".concat(a,"' and ").concat(se),void 0,g),v={source_id:a,relation_types:B,topk:f||10,enable_prediction:r}}if(Tn(c)){var Se=d==null?void 0:d.filter(function(R){return R}).map(function(R){return"'".concat(R,"'")}).join(",");b=Te("(n)","n.id in [".concat(Se,"]"),"n",g)}if(Mn(c)){var ue=(0,N.uniq)(x==null?void 0:x.map(function(R){return"(n.id = '".concat(R.data.id,"' and n:").concat(R.nlabel,")")})).join(" or "),G="";if(c.relation_types&&c.relation_types.length>0){var Y=(0,N.uniq)(c.relation_types.map(function(R){return"'".concat(R,"'")})).join(",");G=Y?"type(r) in [".concat(Y,"]"):""}if(c.query_mode=="each"){var ye="(".concat(ue,") ").concat(G?"and "+G:""),ge=G?"WHERE ".concat(G):"",Ne="CALL { WITH n MATCH (n)-[r]-(m:".concat(t,") ").concat(ge,"  RETURN m LIMIT ").concat(g," }");b=Te("(n)-[r]-(:".concat(t,")"),"".concat(ye," ").concat(Ne),"n,r,m")}else b=Te("(n)-[r]-(m:".concat(t,")"),"".concat(ue," ").concat(G),"n,r,m",g)}if(Gn(c)){var fe=c.nodes,ie=c.nsteps,Le=(0,N.uniq)(fe==null?void 0:fe.map(function(R){return"(n.id = '".concat(R.data.id,"' and n:").concat(R.nlabel,")")})).join(" or "),ke=(0,N.uniq)(fe==null?void 0:fe.map(function(R){return"(m.id = '".concat(R.data.id,"' and m:").concat(R.nlabel,")")})).join(" or "),ze="(".concat(Le,") ").concat(ie&&ie==1?"and":"or"," (").concat(ke,")");b=Te("(n)-[r*1..".concat(ie||3,"]-(m)"),ze,"n,r,m",g)}console.log("query_str: ",b),Object.keys(b).length>0?(0,Ce.zV)((0,m.Z)({query_map:b},v)).then(function(R){R?S(R):j(R)}).catch(function(R){j(R)}):S({nodes:[],edges:[]})}Dn(c)&&(0,Ce.aU)({source_type:t,source_id:"".concat(a),topk:f||10}).then(function(R){console.log("Find similar nodes: ",R),R?S(R):j(R)}).catch(function(R){console.log("Error when finding similar nodes: ",R),j(R)})})}var xl=function(t,a){return new Promise(function(n,o){t&&a?postNodes({query_map:Te("(n:".concat(t,")-[r]-(m)"),"n.id = '".concat(a,"'"))}).then(function(r){r?n(r):o(r)}).catch(function(r){o(r)}):n({nodes:[],edges:[]})})},Ja=function(t,a){return new Promise(function(n,o){var r=t.split("::")[1],i=a.map(function(l){return"'".concat(l.split("::")[1],"'")}).join(",");(0,Ce.zV)({query_map:Te("(n)-[r]-(m)","n.id = '".concat(r,"' and m.id in [").concat(i,"]")),source_id:t,target_ids:a,enable_prediction:!0}).then(function(l){l?n(l):o(l)}).catch(function(l){o(l)})})},Xa=function(t,a,n,o){return new Promise(function(r,i){(0,Ce.jN)({source_id:t,source_type:a,target_ids:n,target_types:o}).then(function(l){console.log("Get dimensions: ",l),r(l.data)}).catch(function(l){console.log("Error when getting dimensions: ",l),i([])})})},qa={type:"grid"},er={type:"graphin-force",workerEnabled:!1,gpuEnabled:!1,animation:!0,preset:{type:"force"},clustering:!0,leafCluster:!0,preventOverlap:!0,nodeClusterBy:"nlabel",clusterNodeStrength:40,minNodeSpacing:20,nodeSize:40,defSpringLen:function(t,a,n){var o,r,i=40,l=(o=a.data.layout)===null||o===void 0?void 0:o.degree,d=(r=n.data.layout)===null||r===void 0?void 0:r.degree,f=Math.min(l,d);return f===1?i*4:Math.min(f*i*1.5,200)},getId:function(t){return t.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 50}},ut=[{type:"preset"},{type:"auto"},(0,m.Z)({},er),{type:"force",workerEnabled:!1,gpuEnabled:!1,animation:!0,preset:{type:"grid"},clustering:!0,leafCluster:!0,preventOverlap:!0,clusterAttr:"nlabel",nodeClusterBy:"nlabel",clusterNodeStrength:40,minNodeSpacing:20,nodeSize:40,defSpringLen:function(t,a,n){var o,r,i=40,l=(o=a.data.layout)===null||o===void 0?void 0:o.degree,d=(r=n.data.layout)===null||r===void 0?void 0:r.degree,f=Math.min(l,d);return f===1?i*4:Math.min(f*i*1.5,200)},getId:function(t){return t.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 50}},{type:"grid",begin:[0,0],preventOverlap:!0,preventOverlapPdding:20,nodeSize:30,condense:!1,rows:5,cols:5,sortBy:"degree",workerEnabled:!1},{type:"radial",center:[200,200],linkDistance:80,maxIteration:1e3,sortBy:"degree",unitRadius:150,preventOverlap:!0,nodeSize:30,strictRadial:!1,workerEnabled:!1},{type:"concentric",center:[200,200],preventOverlap:!0,nodeSize:30,sweep:10,minNodeSpacing:5,equidistant:!0,startAngle:0,clockwise:!0,maxLevelDiff:.5,sortBy:"degree",workerEnabled:!1}],tr=function(t){var a=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;return a.test(t)},At=function(t){if(!t)return[];var a=t.getNodes().filter(function(n){return n.hasState("selected")});return a.map(function(n){return n.getModel()})},nr=function(t){if(!t)return[];var a=t.getNodes();return a.map(function(n){return n.getModel()})},On=function(t){var a={nodes:t.getNodes().map(function(o){var r=o.getModel();return(0,m.Z)((0,m.Z)({},r),{},{style:r._initialStyle,_initialStyle:r.style})}),edges:t.getEdges().map(function(o){var r=o.getModel();return(0,m.Z)((0,m.Z)({},r),{},{style:r._initialStyle,_initialStyle:r.style})})},n=t.get("layout");return{data:a,layout:{type:"preset"},defaultLayout:n}},Sl=u(74379),Yt=u(38648),Zl=u(49111),Jt=u(19650),bl=u(47673),Ft=u(4107),Qe=u(32059),ar=u(37763),rr=u.n(ar),Ln=u(76570),or=u(92570),ir=u(72850);function lr(c,t,a,n,o){for(var r=[],i=[{nodeId:c,path:[c]}],l=new Set([c]),d=new Set,f=function(){var S=i.shift(),j=S.nodeId,v=S.path;if(j===t){for(var b=v.map(function(M){var I=a.find(function(L){return L.id===M});return I?I.id:a[0].id}),g=[],Z=function(I){var L=a.find(function($){return $.id===v[I-1]}),B=a.find(function($){return $.id===v[I]});if(L&&B){var U=n.find(function($){return $.source===L.id&&$.target===B.id||$.source===B.id&&$.target===L.id});U?g.push(U.relid):g.push("")}},E=1;E<v.length;E++)Z(E);var k=b.join(",")+":"+g.join(",");d.has(k)||(r.push({nodes:b,edges:g}),d.add(k))}else{var D=o.get(j)||[],C=(0,$e.Z)(D),O;try{for(C.s();!(O=C.n()).done;){var _=O.value;l.has(_)||(l.add(_),i.push({nodeId:_,path:[].concat((0,de.Z)(v),[_])}))}}catch(M){C.e(M)}finally{C.f()}}};i.length>0;)f();return r}function sr(c,t,a,n,o){var r=[],i=[];function l(d){if(r.push(d),d===t)i.push({nodes:r.map(function(v){var b=a.find(function(g){return g.id===v});return b?b.id:a[0].id}),edges:r.slice(1).map(function(v,b){var g=a.find(function(k){return k.id===r[b]}),Z=a.find(function(k){return k.id===v});if(g&&Z){var E=n.find(function(k){return k.source===g.id&&k.target===Z.id||k.source===Z.id&&k.target===g.id});return E?E.relid:""}else return""})});else{var f=o.get(d)||[],x=(0,$e.Z)(f),S;try{for(x.s();!(S=x.n()).done;){var j=S.value;!r.includes(j)&&r.length<=3&&l(j)}}catch(v){x.e(v)}finally{x.f()}}r.pop()}return l(c),i}var dr=function(t){var a=(0,s.useState)(""),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)(""),l=(0,y.Z)(i,2),d=l[0],f=l[1],x=s.useRef(null),S=s.useRef(null),j=(0,s.useContext)(Pe.Z),v=j.graph,b=(0,s.useState)({}),g=(0,y.Z)(b,2),Z=g[0],E=g[1],k=(0,s.useState)({}),D=(0,y.Z)(k,2),C=D[0],O=D[1],_=(0,s.useState)(null),M=(0,y.Z)(_,2),I=M[0],L=M[1],B=(0,s.useState)(!1),U=(0,y.Z)(B,2),$=U[0],se=U[1],Se=(0,s.useState)([]),ue=(0,y.Z)(Se,2),G=ue[0],Y=ue[1];(0,s.useEffect)(function(){if(!(t.selectedNodes.length<=1)){var J=t.selectedNodes[0].id,Q=(0,$e.Z)(t.selectedNodes),X;try{var T=function(){var h=X.value,w=J+"_"+h.id;if(!Z[w]){var F=t.algorithm=="bfs"?lr:sr,z=F(t.selectedNodes[0].id,h.id,t.nodes,t.edges,t.adjacencyList);E(function(te){return(0,m.Z)((0,m.Z)({},te),{},(0,Qe.Z)({},w,z))}),O(function(te){return(0,m.Z)((0,m.Z)({},te),{},(0,Qe.Z)({},w,t.algorithm))})}};for(Q.s();!(X=Q.n()).done;)T()}catch(p){Q.e(p)}finally{Q.f()}}},[t.selectedNodes]),(0,s.useEffect)(function(){for(var J=[],Q=0,X=Object.keys(Z);Q<X.length;Q++)for(var T=X[Q],p=0;p<Z[T].length;p++)J.push({key:T,index:p,path:Z[T][p].nodes.map(function(h){var w=t.nodes.find(function(F){return F.id===h});return w?w.data.name:"Unknown"}).join(" -> "),nsteps:Z[T][p].edges.length});Y((0,N.uniqBy)((0,N.sortBy)(J,["nsteps"]),"path"))},[Z]);function ye(J){ge();var Q=J.some(function(w){return w.nodes.length>0});(J.length===0||!Q)&&K.ZP.warning("No path found");var X=(0,de.Z)(new Set(J.flatMap(function(w){return w.nodes}))),T=(0,de.Z)(new Set(J.flatMap(function(w){return w.edges}))),p=v.getNodes();p.forEach(function(w){var F=w.getModel();F.id&&!X.includes(F.id)?v.setItemState(w,"inactive",!0):v.setItemState(w,"active",!0)});var h=v.getEdges();h.forEach(function(w){var F=w.getModel();F.relid&&!T.includes(F.relid)?v.setItemState(w,"inactive",!0):v.setItemState(w,"active",!0)})}function ge(){var J=v.getNodes();J.forEach(function(X){v.setItemState(X,"inactive",!1)});var Q=v.getEdges();Q.forEach(function(X){v.setItemState(X,"inactive",!1)})}function Ne(J){var Q=(0,de.Z)(new Set(J.flatMap(function(h){return h.nodes}))),X=(0,de.Z)(new Set(J.flatMap(function(h){return h.edges}))),T=v.getNodes();T.forEach(function(h){var w=h.getModel();w.id&&!Q.includes(w.id)?v.setItemState(h,"inactive",!1):v.setItemState(h,"active",!1)});var p=v.getEdges();p.forEach(function(h){var w=h.getModel();w.relid&&!X.includes(w.relid)?v.setItemState(h,"inactive",!1):v.setItemState(h,"active",!1)})}var fe=function(){E({}),t.onClosePathsFinder()},ie=function(Q){se(!Q)},Le=function(){if(t.selectedNodes.length<=1)return null;var Q=t.selectedNodes[0].id;return t.selectedNodes.map(function(X){var T=Q+"_"+X.id;return(0,e.jsxs)("li",{className:C[T],onMouseEnter:function(){ye(Z[T])},onMouseLeave:function(){Ne(Z[T])},children:[(0,e.jsx)("span",{children:X.data.name}),"\xA0",(0,e.jsx)("span",{children:C[T]==="bfs"?"BFS":"DFS"})]},T)})},ke=function(Q,X,T){X(),r(Q[0]),f(T)},ze=function(Q){Q(),r("")},R=function(Q){return{filterDropdown:function(T){var p=T.setSelectedKeys,h=T.selectedKeys,w=T.confirm,F=T.clearFilters,z=T.close;return(0,e.jsxs)("div",{style:{padding:8},onKeyDown:function(re){return re.stopPropagation()},children:[(0,e.jsx)(Ft.Z,{ref:x,placeholder:"Search ".concat(Q),value:h[0],onChange:function(re){return p(re.target.value?[re.target.value]:[])},onPressEnter:function(){return ke(h,w,Q)},style:{marginBottom:8,display:"block"}}),(0,e.jsxs)(Jt.Z,{children:[(0,e.jsx)(W.Z,{type:"primary",onClick:function(){return ke(h,w,Q)},icon:(0,e.jsx)(Ln.Z,{}),size:"small",style:{width:90},children:"Search"}),(0,e.jsx)(W.Z,{onClick:function(){return F&&ze(F)},size:"small",style:{width:90},children:"Reset"}),(0,e.jsx)(W.Z,{type:"link",size:"small",onClick:function(){w({closeDropdown:!1}),r(h[0]),f(Q)},children:"Filter"}),(0,e.jsx)(W.Z,{type:"link",size:"small",onClick:function(){z()},children:"close"})]})]})},filterIcon:function(T){return(0,e.jsx)(Ln.Z,{style:{color:T?"#1890ff":void 0}})},onFilter:function(T,p){return p[Q].toString().toLowerCase().includes(T.toLowerCase())},onFilterDropdownOpenChange:function(T){T&&setTimeout(function(){var p;return(p=x.current)===null||p===void 0?void 0:p.select()},100)},render:function(T){return d===Q?(0,e.jsx)(rr(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[o],autoEscape:!0,textToHighlight:T?T.toString():""}):T}}},_e=[(0,m.Z)({title:"Path",key:"path",align:"center",dataIndex:"path",width:300},R("path")),{title:"Num of Steps",dataIndex:"nsteps",key:"nsteps",align:"center",width:150,sorter:function(Q,X){return Q.nsteps-X.nsteps},sortDirections:["descend","ascend"]},{title:"Action",key:"action",align:"center",fixed:"right",width:150,render:function(Q,X,T){return(0,e.jsxs)(Jt.Z,{children:[(0,e.jsx)(W.Z,{size:"small",type:"link",disabled:X.path===I,onClick:function(h){var w=X.key,F=X.index,z=[Z[w][F]];ye(z),L(X.path)},children:"Show"}),(0,e.jsx)(W.Z,{size:"small",type:"link",onClick:function(h){Yt.Z.open({type:"info",message:"Explain the Current Path",description:"Not implemented yet (We will try to train a LLM with knowledge graph to explain why the path would be believable)",duration:10})},children:"Explain"})]})}}];return(0,e.jsxs)("div",{className:"show-paths-panel",children:[(0,e.jsxs)("div",{className:"title",children:[(0,e.jsx)("h3",{children:"Paths Finder"}),(0,e.jsxs)("span",{children:[(0,e.jsx)(or.Z,{onClick:function(){return ie($)}}),(0,e.jsx)(ir.Z,{onClick:fe})]})]}),(0,e.jsx)("ul",{className:"status-ul body",children:Le()}),$?(0,e.jsx)(Gt,{title:"Path Table",onClose:function(){L(null),se(!1)},width:"600px",children:(0,e.jsx)(He.Z,{className:"path-table",rowKey:function(Q){return"".concat(Q.index,"-").concat(Q.path)},columns:_e,dataSource:G,ref:S,scroll:{y:200},size:"small",pagination:{simple:!0,defaultPageSize:1e3,position:["topLeft"],showTotal:function(Q){return"Total ".concat(Q," items")}}})}):null]})},cr=dr,ur=u(18045),fr=Mt.Z.MiniMap,hr=Mt.Z.SnapLine,Rn=Mt.Z.Tooltip,An=Mt.Z.Legend,vr=Fe.Z.ZoomCanvas,pr=Fe.Z.ActivateRelations,gr=Fe.Z.ClickSelect,mr=Fe.Z.Hoverable,yr=Fe.Z.FitView,xr=Fe.Z.DragNodeWithForce,Sr=Fe.Z.DragNode,Zr=Fe.Z.LassoSelect,br=Fe.Z.BrushSelect,nt=Ot.Z.Menu,Cr={line:{stroke:"lightgreen",lineWidth:1}},jr=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=a.apis,r=t.item,i=t.chatbotVisible,l=t.onExplainRelationship,d=(0,s.useState)(!1),f=(0,y.Z)(d,2),x=f[0],S=f[1],j=(0,s.useState)(void 0),v=(0,y.Z)(j,2),b=v[0],g=v[1],Z=(0,s.useState)(void 0),E=(0,y.Z)(Z,2),k=E[0],D=E[1],C=(0,s.useState)(void 0),O=(0,y.Z)(C,2),_=O[0],M=O[1];(0,s.useEffect)(function(){if(r){var B=r.getModel(),U=n.findById(B.source).getModel(),$=n.findById(B.target).getModel();U&&$&&B&&(g(U),D($),M(B),S(!0))}else S(!1),g(void 0),D(void 0),M(void 0)},[]);var I=[{key:"show-edge-details",icon:(0,e.jsx)(mn.Z,{}),label:"Show Edge Details"},{key:"explain-relationship",icon:(0,e.jsx)(Oa.Z,{}),label:"Explain Relationship (Experimental)"},{key:"analyze-with-clinical-data",icon:(0,e.jsx)(yn.Z,{}),label:"Analyze with Clinical Data",children:[{key:"barchart",icon:(0,e.jsx)(yn.Z,{}),label:"Bar Chart"},{key:"boxchart",icon:(0,e.jsx)(La.Z,{}),label:"Box Plot"},{key:"heatmap",icon:(0,e.jsx)(xn.Z,{}),label:"Heatmap"},{key:"scatterchart",icon:(0,e.jsx)(Qt.Z,{}),label:"Scatter Chart"}]},{key:"analyze-with-omics-data",icon:(0,e.jsx)(Ra.Z,{}),label:"Analyze with Omics Data",children:[{key:"heatmap-omics",icon:(0,e.jsx)(xn.Z,{}),label:"Heatmap"},{key:"scatterchart-omics",icon:(0,e.jsx)(Qt.Z,{}),label:"Scatter Chart"}]}];i&&I.push({key:"ask-question",icon:(0,e.jsx)(Sn.Z,{}),label:"Ask Chatbot",children:[{key:"what-is-the-relationship",icon:(0,e.jsx)(Aa.Z,{}),label:"What is the relationship between the two nodes?"}]});var L=function(U){t.onChange&&b&&k&&_&&n&&o?(t.onChange(U,b,k,_,n,o),S(!1)):K.ZP.warn("Cannot catch the changes.")};return x?(0,e.jsx)(vn.Z,{items:I,onClick:L}):null},Nr=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=a.apis,r=t.item,i=t.chatbotVisible,l=(0,s.useState)(!1),d=(0,y.Z)(l,2),f=d[0],x=d[1];console.log("NodeMenu",t.item);var S=(0,s.useState)(void 0),j=(0,y.Z)(S,2),v=j[0],b=j[1];(0,s.useEffect)(function(){if(r&&r._cfg){var E=r.getModel();b(E),x(!0)}else x(!1),b(void 0)},[]);var g=[{key:"show-node-details",icon:(0,e.jsx)(mn.Z,{}),label:"Show Node Details"},{key:"expand-one-level",icon:(0,e.jsx)(Fa.Z,{}),label:"Expand One Level"},{key:"expand-selected-nodes",icon:(0,e.jsx)(Pt.Z,{}),label:"Expand Selected Nodes"},{key:"reverse-selected-nodes",icon:(0,e.jsx)(za.Z,{}),label:"Reverse Selected Nodes"},{key:"predict-relationships",icon:(0,e.jsx)(Va.Z,{}),label:"Predict Relationships"},{key:"visulize-similarities",icon:(0,e.jsx)(Qt.Z,{}),label:"Visualize Similarities"},{key:"expand-all-paths",icon:(0,e.jsx)(Lt.Z,{}),label:"Expand Paths (Within 3 Steps)",children:[{key:"expand-all-paths-1",icon:(0,e.jsx)(Lt.Z,{}),label:"Within 1 Step"},{key:"expand-all-paths-2",icon:(0,e.jsx)(Lt.Z,{}),label:"Within 2 Step"},{key:"expand-all-paths-3",icon:(0,e.jsx)(Lt.Z,{}),label:"Within 3 Step"}]},{key:"delete-nodes",icon:(0,e.jsx)(Ba.Z,{}),label:"Delete Selected Node(s)",danger:!0}];i&&g.push({key:"ask-question",icon:(0,e.jsx)(Sn.Z,{}),label:"Ask Chatbot",children:[{key:"what-is-the-node",icon:(0,e.jsx)(Zn.Z,{}),label:"What is the node?"}]});var Z=function(k){k.key==="reverse-selected-nodes"?(n.getNodes().forEach(function(D){D.hasState("selected")?n.setItemState(D,"selected",!1):n.setItemState(D,"selected",!0)}),v&&n.setItemState(v.id,"selected",!1),x(!1)):t.onChange&&v&&n&&o?(t.onChange(k,v,n,o),x(!1)):K.ZP.warn("Cannot catch the changes.")};return f?(0,e.jsx)(vn.Z,{items:g,onClick:Z}):null},kr=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=a.contextmenu,r=a.apis,i=o.canvas,l=function(){if(n.getNodes().length==0){K.ZP.warn("No data to download");return}n.downloadFullImage("canvas","image/png",{backgroundColor:"#fff",padding:10}),i.handleClose()},d=function(){var v=On(n);if(v.data.nodes.length==0){K.ZP.warn("No data to download");return}var b={payload:v,name:"shared-graph",description:"Shared graph"},g=new Blob([JSON.stringify(b)],{type:"application/json"}),Z=document.createElement("a");Z.href=URL.createObjectURL(g),Z.download="graph.json",Z.click()},f=function(){t.onCanvasClick&&t.onCanvasClick({key:"auto-connect",name:"AutoConnect"},n,r)},x=function(){t.onClearGraph?(t.onClearGraph(),K.ZP.info("Clear canvas successfully")):K.ZP.warn("Cannot clear canvas"),i.handleClose()},S=function(){t.handleOpenFishEye&&t.handleOpenFishEye()};return(0,e.jsxs)(nt,{bindType:"canvas",children:[(0,e.jsx)(nt.Item,{onClick:f,children:(0,e.jsxs)(W.Z,{type:"text",children:[(0,e.jsx)(Rt.Z,{})," Auto Connect Graph"]})}),(0,e.jsx)(nt.Item,{onClick:S,children:(0,e.jsxs)(W.Z,{type:"text",children:[(0,e.jsx)(Zn.Z,{})," Enable FishEye"]})}),(0,e.jsx)(nt.Item,{onClick:d,children:(0,e.jsxs)(W.Z,{type:"text",children:[(0,e.jsx)(Ua.Z,{})," Download Graph Data"]})}),(0,e.jsx)(nt.Item,{onClick:l,children:(0,e.jsxs)(W.Z,{type:"text",children:[(0,e.jsx)(It.Z,{})," Save As Image"]})}),(0,e.jsx)(nt.Item,{onClick:x,children:(0,e.jsxs)(W.Z,{type:"text",danger:!0,children:[(0,e.jsx)(Wa.Z,{}),"Clear Canvas"]})})]})},Fn=function(t){var a=t.bindType,n=t.disabled,o=(0,s.useContext)(Pe.Z),r=o.graph,i=(0,s.useState)(!1),l=(0,y.Z)(i,2),d=l[0],f=l[1];return(0,e.jsx)(mr,{bindType:a,disabled:d||n})},wr=function(t){var a=t.visible,n=(0,s.useContext)(Pe.Z).graph;return(0,s.useEffect)(function(){n.getNodes().forEach(function(o){n.updateItem(o,{style:{label:{visible:a}}})})},[a]),null},Er=function(t){var a=t.visible,n=(0,s.useContext)(Pe.Z).graph;return(0,s.useEffect)(function(){n.getEdges().forEach(function(o){n.updateItem(o,{style:{label:{visible:a}}})})},[a]),null},Pr=function(t){if(t.selectedNode){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=n.getNodes(),r=n.getEdges();t.mode=="activate"?(o.forEach(function(i){n.setItemState(i,"inactive",!1),n.setItemState(i,"active",!1)}),o.forEach(function(i){var l=i.getModel();t.selectedNode&&t.selectedNode!==l.id?(console.log("UnSelected Node: ",t.selectedNode,l.id),n.setItemState(i,"inactive",!0)):(console.log("Selected Node: ",t.selectedNode,l.id),n.setItemState(i,"active",!0))})):n.focusItem(t.selectedNode,!0)}return null},zn=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=a.apis;return(0,s.useEffect)(function(){t.queriedId&&t.mode=="focus"&&o.focusNodeById(t.queriedId);var r=function(l){var d=l.item,f=d.getModel();t.mode=="focus"&&o.focusNodeById(f.id),t.onClickNode&&t.onClickNode(d.getModel())};return n.on("node:click",r),function(){n.off("node:click",r)}},[]),null},Ir=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=a.apis;return(0,s.useEffect)(function(){var r=function(l){if(t.onClick){var d=l.item,f=d.getModel();t.onClick(f.id,f)}};return n.on("node:click",r),function(){n.off("node:click",r)}},[]),null},Tr=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=a.apis;return(0,s.useEffect)(function(){var r=function(l){if(t.onClick){var d=l.item,f=d.getModel(),x=n.findById(f.source).getModel(),S=n.findById(f.target).getModel();t.onClick(f.relid,x,S,f)}};return n.on("edge:click",r),function(){n.off("edge:click",r)}},[]),null},Dr=function(){var t=(0,s.useContext)(Pe.Z),a=t.graph,n=t.apis,o=(0,s.useState)(!1),r=(0,y.Z)(o,2),i=r[0],l=r[1],d=(0,s.useState)([]),f=(0,y.Z)(d,2),x=f[0],S=f[1],j=function(g){console.log("handleNodeSelectorChange: ",g),g&&n.focusNodeById(g)},v=function(g){if(console.log("handleNodeSearch: ",g),l(!0),g){var Z=[];a.getNodes().forEach(function(E){var k=E.getModel();console.log("handleNodeSearch: ",k),(k.label&&k.label.toLowerCase().includes(g.toLowerCase())||k.data.name&&k.data.name.toLowerCase().includes(g.toLowerCase()))&&Z.push({label:"".concat(k.id," | ").concat(k.data.name),value:k.id})}),S(Z),l(!1)}else S([]),l(!1)};return(0,e.jsx)(Ze.Z,{className:"node-searcher",showSearch:!0,allowClear:!0,loading:i,defaultActiveFirstOption:!1,showArrow:!0,placement:"topRight",placeholder:"Search nodes",onSearch:v,onChange:j,options:x,filterOption:!1,notFoundContent:(0,e.jsx)(Ee.Z,{description:i?"Searching...":x!==void 0?"Not Found":"Enter your interested node ..."})})},Mr={autoPin:!1,nodeLabelVisible:!0,edgeLabelVisible:!0,nodeTooltipEnabled:!0,edgeTooltipEnabled:!1,interactiveMode:"select-nodes",selectionMode:"brush-select",miniMapEnabled:!0,snapLineEnabled:!0,infoPanelEnabled:!0},Gr=function(t){var a,n,o=t.data,r=t.style,i=t.onNodeMenuClick,l=t.onEdgeMenuClick,d=t.selectedNode,f=t.onCanvasMenuClick,x=(0,s.useState)(!1),S=(0,y.Z)(x,2),j=S[0],v=S[1],b=(0,s.useState)(!1),g=(0,y.Z)(b,2),Z=g[0],E=g[1],k=(0,s.useState)({}),D=(0,y.Z)(k,2),C=D[0],O=D[1],_=(0,s.useState)(null),M=(0,y.Z)(_,2),I=M[0],L=M[1],B=(0,s.useState)(null),U=(0,y.Z)(B,2),$=U[0],se=U[1],Se=(0,s.useState)([]),ue=(0,y.Z)(Se,2),G=ue[0],Y=ue[1],ye=(0,s.useState)({}),ge=(0,y.Z)(ye,2),Ne=ge[0],fe=ge[1],ie=s.useRef(null),Le=(0,e.jsx)("p",{style:{width:"400px"},children:'If you would like to select multiple nodes, please set the interactive mode to "select-nodes". Then press the "Shift" key and click the nodes you want to select.'});(0,s.useEffect)(function(){T(),ie&&ie.current&&ie.current.graph&&(ie.current.graph.on("edge:contextmenu",function(p){L(p.item)}),ie.current.graph.on("node:contextmenu",function(p){se(p.item)}))},[]),(0,s.useEffect)(function(){Y([])},[C.interactiveMode]),(0,s.useEffect)(function(){ie.current&&ie.current.graph&&(console.log("Updating layout: ",t.layout),ie.current.graph.updateLayout(t.layout),ie.current.graph.refreshPositions(),ie.current.graph.fitView())},[t.layout]),(0,s.useEffect)(function(){var p=new Map,h=(0,$e.Z)(o.nodes),w;try{for(h.s();!(w=h.n()).done;){var F=w.value;p.set(F.id,[])}}catch(he){h.e(he)}finally{h.f()}var z=(0,$e.Z)(o.edges),te;try{for(z.s();!(te=z.n()).done;){var re=te.value;p.get(re.source).push(re.target),p.get(re.target).push(re.source)}}catch(he){z.e(he)}finally{z.f()}fe(p)},[o]);var ke=function(){v(!0)},ze=function(){v(!1)},R=function(h){Y(function(w){return[].concat((0,de.Z)(w),[h])})},_e=function(){Y([])},J=function(h){var w=h.data,F=h.style;console.log("HoverText: ",w);var z=jn(w,["comboId","degree","depth","layoutOrder","x","y","type","category"]),te=Object.keys(z).map(function(re){return z[re]?(0,e.jsx)(Dt.Z.Item,{label:Ue.Z.titleCase(re),style:{height:"50px",overflowY:"scroll"},children:z[re]},re):null});return te.length>0?(0,e.jsx)(Dt.Z,{size:"small",column:1,title:null,bordered:!0,style:F,children:te}):(0,e.jsx)("span",{style:F,children:"No Properties"})},Q={enabledStack:!0,filterCenter:!0},X=function(h,w){console.log(h,w)},T=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"graphin-settings",w=JSON.parse(localStorage.getItem(h)||"{}");Object.keys(w).length===0?O(Mr):(O(w),K.ZP.success("Settings loaded"))};return o&&(0,e.jsxs)(Pa.ZP,{ref:ie,layoutCache:!0,options:Q,data:o,layout:t.layout,style:r,children:[(0,e.jsx)(yr,{}),(0,e.jsx)(xr,{autoPin:C.autoPin}),(0,e.jsx)(Sr,{}),(0,e.jsx)(vr,{}),C.selectionMode=="lasso-select"?(0,e.jsx)(Zr,{}):null,C.selectionMode=="brush-select"?(0,e.jsx)(br,{}):null,(0,e.jsx)(wr,{visible:C.nodeLabelVisible}),(0,e.jsx)(Er,{visible:C.edgeLabelVisible}),(0,e.jsx)(Ga.Z,{options:{},visible:j,handleEscListener:ze}),(0,e.jsx)(Pr,{selectedNode:d,mode:t.highlightMode}),C.interactiveMode=="show-paths"?(0,e.jsx)(Fn,{bindType:"node"}):null,C.interactiveMode=="show-paths"?(0,e.jsx)(Fn,{bindType:"edge"}):null,C.interactiveMode=="show-paths"?(0,e.jsx)(pr,{}):null,(0,e.jsx)(Ot.Z,{style:{width:"160px"},children:(0,e.jsx)(Nr,{chatbotVisible:t.chatbotVisible,item:$,onChange:function(h,w,F,z){se(null),i&&i(h,w,F,z)}})}),(0,e.jsx)(Ot.Z,{style:{width:"160px"},bindType:"canvas",children:(0,e.jsx)(kr,{handleOpenFishEye:ke,onCanvasClick:function(h,w,F){se(null),L(null),f&&f(h,w,F)},onClearGraph:t.onClearGraph})}),(0,e.jsx)(Ot.Z,{style:{width:"160px"},bindType:"edge",children:(0,e.jsx)(jr,{item:I,chatbotVisible:t.chatbotVisible,onChange:function(h,w,F,z,te,re){L(null),h.key=="explain-relationship"&&(L(z),E(!0)),l&&l(h,w,F,z,te,re)}})}),(0,e.jsx)(An,{bindType:"node",sortKey:"nlabel",children:function(h){return console.log("renderProps",h),(0,e.jsx)(An.Node,(0,m.Z)((0,m.Z)({},h),{},{onChange:X}))}}),t.toolbarVisible?(0,e.jsx)(Gt,{title:"Settings",width:"220px",top:"100px",right:"30px",help:Le,children:(0,e.jsxs)(je.Z,{style:{position:"relative",marginBottom:"0px",opacity:.8},direction:"horizontal",children:[(0,e.jsx)(je.Z.Item,{children:(0,e.jsx)(Ze.Z,{style:{width:"100%"},allowClear:!0,defaultValue:t.layout.type,onChange:function(h){if(h=="auto")ur.n.predict(o).then(function(z){console.log("Predicted layout: ",z);var te=ut.find(function(re){return re.type===z.predictLayout});te?(K.ZP.info("Predicted layout: ".concat(z.predictLayout)),t.changeLayout&&t.changeLayout(te)):K.ZP.error("Predicted layout is ".concat(z.predictLayout,", but it is not supported currently."))}).catch(function(z){console.log(z),K.ZP.error("Failed to predict layout: ".concat(z.message))});else if(h=="graphin-force"){K.ZP.warn("The layout '".concat(h,"' may not work well with the device which doesn't support GPU."));var w=ut.find(function(z){return z.type===h});t.changeLayout&&t.changeLayout(w)}else{var F=void 0;h?F=ut.find(function(z){return z.type===h}):F=ut.find(function(z){return z.type==="force"}),t.changeLayout&&F&&t.changeLayout(F)}},placeholder:"Select a layout",children:ut.map(function(p){var h=p.type;return(0,e.jsxs)(Ze.Z.Option,{value:h,children:[(0,e.jsx)(Rt.Z,{}),"\xA0",h]},h)})})}),(0,e.jsx)(je.Z.Item,{children:(0,e.jsx)(Ze.Z,{style:{width:"100%"},allowClear:!0,value:C.interactiveMode,onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{interactiveMode:h}))},placeholder:"Select a interactive mode",children:["show-details","select-nodes","show-paths"].map(function(p){return(0,e.jsxs)(Ze.Z.Option,{value:p,children:[(0,e.jsx)(Rt.Z,{}),"\xA0",Ue.Z.titleCase(p)]},p)})})}),(0,e.jsx)(je.Z.Item,{children:(0,e.jsx)(Ze.Z,{style:{width:"100%"},allowClear:!0,defaultValue:"brush-select",disabled:C.interactiveMode!=="select-nodes",onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{selectionMode:h}))},placeholder:"Select a selection mode",children:["brush-select","lasso-select"].map(function(p){return(0,e.jsxs)(Ze.Z.Option,{value:p,children:[(0,e.jsx)(Rt.Z,{}),"\xA0",Ue.Z.titleCase(p)]},p)})})}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{autoPin:h}))},checked:C.autoPin,disabled:!0}),"Auto Pin"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{nodeLabelVisible:h}))},checked:C.nodeLabelVisible}),"Node Label"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{edgeLabelVisible:h}))},checked:C.edgeLabelVisible}),"Edge Label"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{nodeTooltipEnabled:h}))},checked:C.nodeTooltipEnabled}),"Node Tooltip"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{edgeTooltipEnabled:h}))},checked:C.edgeTooltipEnabled}),"Edge Tooltip"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{miniMapEnabled:h}))},checked:C.miniMapEnabled}),"MiniMap"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{snapLineEnabled:h}))},checked:C.snapLineEnabled}),"SnapLine"]}),(0,e.jsxs)(je.Z.Item,{children:[(0,e.jsx)(me.Z,{onChange:function(h){O((0,m.Z)((0,m.Z)({},C),{},{infoPanelEnabled:h}))},checked:C.infoPanelEnabled}),"Info Panel"]}),(0,e.jsx)(je.Z.Item,{children:(0,e.jsx)(W.Z,{type:"primary",size:"small",style:{width:"100%"},onClick:function(){localStorage.setItem("graphin-settings",JSON.stringify(C)),K.ZP.success("Settings saved")},children:"Save Settings"})}),(0,e.jsx)(je.Z.Item,{children:(0,e.jsx)(W.Z,{danger:!0,size:"small",style:{width:"100%"},onClick:function(){T()},children:"Load Settings"})})]})}):null,(0,e.jsx)(Dr,{}),C.interactiveMode=="show-paths"?(0,e.jsx)(zn,{queriedId:t.queriedId,onClickNode:R,mode:"focus"}):null,C.interactiveMode=="select-nodes"?(0,e.jsx)(zn,{queriedId:t.queriedId,onClickNode:R,mode:"select"}):null,C.interactiveMode=="show-paths"?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(cr,{selectedNodes:G,nodes:o.nodes,edges:o.edges,onClosePathsFinder:_e,adjacencyList:Ne,algorithm:o.edges.length>500?"bfs":"dfs"})}):null,I&&Z?(0,e.jsxs)(Gt,{onClose:function(){E(!1)},children:["TODO: generate explanations for the current edge",(0,e.jsx)("br",{}),"1. Get the current edge, the source node and target node",(0,e.jsx)("br",{}),"2. Send the source node and target node to the backend and get the prompt (markdown format) which contains the prompt and api codes for retrieving context information",(0,e.jsx)("br",{}),"3. Send the markdown to the backend and get the filled markdown",(0,e.jsx)("br",{}),"4. Send the filled markdown to LLM and generate explanations by using `rethinking with retrieval` method",(0,e.jsx)("br",{}),"5. Show the filled markdown in the explanation panel",(0,e.jsx)("br",{})]}):null,C.interactiveMode=="select-nodes"?(0,e.jsx)(gr,{multiple:!0,trigger:"shift"}):null,C.interactiveMode=="show-details"?(0,e.jsx)(Ir,{onClick:t.onClickNode}):null,C.interactiveMode=="show-details"?(0,e.jsx)(Tr,{onClick:t.onClickEdge}):null,C.nodeTooltipEnabled?(0,e.jsx)(Rn,{bindType:"node",hasArrow:!0,placement:"bottom",style:{opacity:.9},children:function(h){if(h.model){var w=h.model;return(0,e.jsx)(J,{data:w,style:{padding:"10px",width:"fit-content",maxWidth:"400px"}})}return null}}):null,C.edgeTooltipEnabled?(0,e.jsx)(Rn,{bindType:"edge",hasArrow:!0,placement:"bottom",style:{opacity:.9},children:function(h){if(h.model){var w=h.model;return(0,e.jsx)(J,{data:w,style:{padding:"10px",width:"fit-content"}})}return null}}):null,C.miniMapEnabled?(0,e.jsx)(fr,{}):null,C.snapLineEnabled?(0,e.jsx)(hr,{options:Cr,visible:!0}):null,C.infoPanelEnabled?(0,e.jsx)(Ha,{data:t.statistics,style:{position:"absolute",top:"0px",left:"0px",zIndex:1}}):null,(0,e.jsx)(pn.Provider,{value:{graph:(a=ie.current)===null||a===void 0?void 0:a.graph,apis:(n=ie.current)===null||n===void 0?void 0:n.apis,selectedNodes:G},children:t.children?t.children:null})]})},Or=Gr,We=u(39428),zt=u(3182),Vt,Lr=function(t){var a=(0,s.useState)([]),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)(!1),l=(0,y.Z)(i,2),d=l[0],f=l[1],x=(0,s.useState)("Search Gene nodes ..."),S=(0,y.Z)(x,2),j=S[0],v=S[1],b=(0,s.useState)(void 0),g=(0,y.Z)(b,2),Z=g[0],E=g[1],k=(0,s.useState)("Gene"),D=(0,y.Z)(k,2),C=D[0],O=D[1],_=function(){var B=(0,zt.Z)((0,We.Z)().mark(function U($,se){var Se;return(0,We.Z)().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:Vt&&(clearTimeout(Vt),Vt=null),Se=function(){f(!0),(0,Ce.g7)({query_str:Nn({id:se,name:se},{},{}),label_type:$}).then(function(ye){var ge=ye.data,Ne=ge.map(function(ie){return{value:ie.id,text:"".concat(ie.id," | ").concat(ie.name)}});console.log("getLabels results: ",Ne);var fe=Ne.map(function(ie){return{label:ie.text,value:ie.value}});f(!1),E(fe)}).catch(function(ye){console.log("requestNodes Error: ",ye),E([]),f(!1)})},Vt=setTimeout(Se,300);case 3:case"end":return G.stop()}},U)}));return function($,se){return B.apply(this,arguments)}}(),M=function(U){O(U),E(void 0),v("Search ".concat(U," nodes ..."))},I=function(U){U?_(C,U):E(void 0)},L=function(U){if(console.log("Handle Change: ",U),U){var $;($=t.onChange)===null||$===void 0||$.call(t,C,U)}else{var se;(se=t.onChange)===null||se===void 0||se.call(t,C,void 0)}};return(0,s.useEffect)(function(){(0,Ce.zX)().then(function(B){console.log("Get types of nodes: ",B);var U=[];B.node_types?(B.node_types.forEach(function($){U.push({order:0,label:$,value:$})}),r(U)):r([])}).catch(function(B){console.log("Get types of nodes error: ",B),r([])})},[]),(0,e.jsxs)(q.Z,{className:"query-builder",children:[(0,e.jsx)(Ze.Z,{value:C,style:{width:"auto",minWidth:"100px"},options:o,onSelect:M}),(0,e.jsx)(Ze.Z,{showSearch:!0,allowClear:!0,loading:d,defaultActiveFirstOption:!1,showArrow:!0,placeholder:j,onSearch:I,onChange:L,options:Z,filterOption:!1,notFoundContent:(0,e.jsx)(Ee.Z,{description:d?"Searching...":Z!==void 0?"Not Found":"Enter your interested ".concat(C," ...")})}),(0,e.jsx)(W.Z,{onClick:t.onAdvancedSearch,children:"Advanced"})]})},Rr=Lr,Cl=u(58996),Ar=u(77933),Fr=u(91966),Vn=u.n(Fr),zr=["leftColumns","rightColumns"],Vr=[{node_id:"MESH:D002289",node_type:"Disease"},{node_id:"MESH:D015673",node_type:"Disease"}],Br=function(){var t="node_id,node_type",a=Vr.map(function(i){return"".concat(i.node_id,",").concat(i.node_type)});a.unshift(t);var n="data:text/csv;charset=utf-8,"+a.join(`
`),o=encodeURI(n),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download","example.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},Ur=[{dataIndex:"node_id",title:"ID",align:"center"},{dataIndex:"node_type",title:"Type",align:"center"},{dataIndex:"matched_id",title:"Matched ID",align:"center"},{dataIndex:"matched_name",title:"Matched Name",align:"center"},{dataIndex:"disabled",title:"Status",align:"center",render:function(t){return(0,e.jsx)(Oe.Z,{children:t?"Not Matched":"Matched"})}}],Wr=[{dataIndex:"node_id",title:"Raw ID",align:"center"},{dataIndex:"matched_id",title:"Matched ID",align:"center"}],Kr=function(t){var a=t.leftColumns,n=t.rightColumns,o=(0,Et.Z)(t,zr);return(0,e.jsx)(Ar.Z,(0,m.Z)((0,m.Z)({},o),{},{children:function(i){var l=i.direction,d=i.filteredItems,f=i.onItemSelectAll,x=i.onItemSelect,S=i.selectedKeys,j=i.disabled,v=l==="left"?a:n,b={getCheckboxProps:function(Z){return{disabled:j||Z.disabled}},onSelectAll:function(Z,E){var k=E.filter(function(C){return!C.disabled}).map(function(C){var O=C.key;return O}),D=Z?Vn()(k,S):Vn()(S,k);f(D,Z)},onSelect:function(Z,E){var k=Z.key;x(k,E)},selectedRowKeys:S};return(0,e.jsx)(He.Z,{rowSelection:b,columns:v,dataSource:d,size:"small",style:{pointerEvents:j?"none":void 0},onRow:function(Z){var E=Z.key,k=Z.disabled;return{onClick:function(){k||j||x(E,!S.includes(E))}}}})}}))},Hr=function(t){var a=(0,s.useState)([]),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=function(){if(o.length===0){K.ZP.warn("Please select at least one node from the left table.");return}else{var f;(f=t.onOk)===null||f===void 0||f.call(t,{node_ids:o,merge_mode:"append",mode:"batchIds"})}},l=function(f){r(f),console.log("targetKeys: ",f)};return(0,e.jsxs)(q.Z,{className:"transfer-table",children:[(0,e.jsx)(Kr,{dataSource:t.dataSource,targetKeys:o,showSearch:!0,onChange:l,filterOption:function(f,x){return x.node_id.indexOf(f)!==-1||x.node_type.indexOf(f)!==-1},leftColumns:Ur,rightColumns:Wr}),(0,e.jsxs)(q.Z,{className:"button-group",children:[(0,e.jsx)(W.Z,{type:"link",onClick:function(){Br()},children:"Download Example File"}),(0,e.jsx)(W.Z,{onClick:t.onCancel,children:"Cancel"}),(0,e.jsx)(W.Z,{type:"primary",onClick:i,children:"Search"})]})]})},$r=Hr,jl=u(43185),Bn=u(11324),Un=u(84391),Qr=u(57460),_r=u.n(Qr),Yr=function(t){var a=(0,s.useState)([]),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=function(f){var x=f.reduce(function(v,b){var g=b.node_type,Z=b.node_id;return v[g]?v[g].push(Z):v[g]=[Z],v},{}),S=Object.keys(x);console.log("UploadNode fetch: ",x,S);var j=S.map(function(v){return(0,Ce.g7)({query_str:"{:select [:*] :where [:in :id ".concat(JSON.stringify(x[v]),"]}"),label_type:v})});return Promise.all(j)};(0,s.useEffect)(function(){t.onUpload(o)},[o]);var l={name:"file",action:"/api/upload",showUploadList:!1,beforeUpload:function(f){var x=new FileReader;return x.readAsText(f),x.onload=function(){_r().parse(x.result,{complete:function(j){var v=[];j.data.length>=100?(K.ZP.warn("The number of nodes should be less than 100, we will only use the first 100 nodes."),v=j.data.slice(0,100)):v=j.data;var b=v.map(function(O,_){return _===0?O.map(function(M){return(0,Qe.Z)({},M,null)}):O.reduce(function(M,I,L){return M[v[0][L]]=I,M},{})});K.ZP.success("Successfully parsed CSV data");var g=b.filter(function(O){return O.node_id&&O.node_type});console.log("Parsed CSV data:",b,g);var Z=[],E=(0,$e.Z)(g),k;try{for(E.s();!(k=E.n()).done;){var D=k.value;Z.push({key:D.node_id,node_id:D.node_id,node_type:D.node_type})}}catch(O){E.e(O)}finally{E.f()}var C=(0,N.uniqBy)(Z,function(O){return"".concat(O.node_id,"-").concat(O.node_type)});Yt.Z.info({message:"Found duplicated nodes",description:"The number of nodes is ".concat(Z.length,", the number of unique nodes is ").concat(C.length)}),console.log("selectedData: ",Z,C),Z=C,Z.length>0?i(Z).then(function(O){var _=(0,N.flatten)(O.map(function(I,L){return I.data})),M=Z.map(function(I,L){var B=_.find(function(U){return"".concat(U.id)===I.node_id});return B?{key:I.node_id,node_id:I.node_id,node_type:I.node_type,matched_id:B.id,matched_name:B.name,disabled:!1}:{key:I.node_id,node_id:I.node_id,node_type:I.node_type,matched_id:"",matched_name:"",disabled:!0}});r(M)}).catch(function(O){console.log(O)}):K.ZP.error("No satisfied data in the uploaded file")},error:function(j){K.ZP.error("Failed to parse CSV data")}})},x.onerror=function(S){K.ZP.error("Failed to read file")},!1}};return(0,e.jsx)(Bn.Z,(0,m.Z)((0,m.Z)({},l),{},{children:(0,e.jsx)(W.Z,{icon:(0,e.jsx)(Un.Z,{}),children:"Upload"})}))},Jr=Yr,Nl=u(77883),Wn=u(49747),kl=u(88983),ft=u(47933),wl=u(9715),ce=u(55843),Bt,Xr=[{label:"Replace",value:"replace"},{label:"Append",value:"append"},{label:"Subtract",value:"subtract"}],qr=[{label:"Query n nodes for each node",value:"each"},{label:"Query n nodes for all nodes",value:"total"}],eo=[{label:"1 Step",value:1},{label:"2 Steps",value:2},{label:"3 Steps",value:3},{label:"4 Steps",value:4},{label:"5 Steps",value:5}],to=function(t){var a,n,o=ce.Z.useForm(),r=(0,y.Z)(o,1),i=r[0],l=ce.Z.useWatch("mode",i),d=ce.Z.useWatch("node_id",i),f=ce.Z.useWatch("node_type",i),x=ce.Z.useWatch("enable_prediction",i),S=ce.Z.useWatch("nsteps",i),j=ce.Z.useWatch("relation_types",i),v=(0,s.useState)([]),b=(0,y.Z)(v,2),g=b[0],Z=b[1],E=(0,s.useState)(!1),k=(0,y.Z)(E,2),D=k[0],C=k[1],O=(0,s.useState)(Qa(t.edgeStat)),_=(0,y.Z)(O,2),M=_[0],I=_[1],L=(0,s.useState)(""),B=(0,y.Z)(L,2),U=B[0],$=B[1],se=(0,s.useState)("Search nodes ..."),Se=(0,y.Z)(se,2),ue=Se[0],G=Se[1],Y=(0,s.useState)(void 0),ye=(0,y.Z)(Y,2),ge=ye[0],Ne=ye[1];(0,s.useEffect)(function(){(0,Ce.zX)().then(function(T){console.log("Get types of nodes: ",T);var p=[];T.node_types?(T.node_types.forEach(function(h){p.push({order:0,label:h,value:h})}),Z(p)):Z([])}).catch(function(T){console.log("requestNodes Error: ",T),K.ZP.error("Get types of nodes error, please refresh the page"),Z([])})},[]),(0,s.useEffect)(function(){var T,p,h,w,F,z,te,re="replace";(T=t.searchObject)!==null&&T!==void 0&&T.merge_mode&&(re=t.searchObject.merge_mode);var he={};if(console.log("props.searchObject: ",t.searchObject),(p=t.searchObject)!==null&&p!==void 0&&p.limit||(he=(0,m.Z)((0,m.Z)({},he),{},{limit:50})),(h=t.searchObject)!==null&&h!==void 0&&h.topk||(he=(0,m.Z)((0,m.Z)({},he),{},{topk:10})),(w=t.searchObject)!==null&&w!==void 0&&w.query_mode||(he=(0,m.Z)((0,m.Z)({},he),{},{query_mode:"each"})),(F=t.searchObject)!==null&&F!==void 0&&F.nsteps||(he=(0,m.Z)((0,m.Z)({},he),{},{nsteps:1})),t.searchObject)for(var Re in t.searchObject)t.searchObject[Re]&&(he=(0,m.Z)((0,m.Z)({},he),{},(0,Qe.Z)({},Re,t.searchObject[Re])));he=(0,m.Z)((0,m.Z)({},he),{},{merge_mode:re}),i.setFieldsValue(he),(z=t.searchObject)!==null&&z!==void 0&&z.node_type&&(te=t.searchObject)!==null&&te!==void 0&&te.node_id&&ke(t.searchObject.node_type,t.searchObject.node_id)},[t.searchObject]),(0,s.useEffect)(function(){return j&&j.length===0?l==="path"||S>1?$("Use all relation types instead of none, but it may take a long time to search."):$(x?"Please select at least one relation type for performance if you enable prediction.":""):$(""),function(){$("")}},[x,S,j]),(0,s.useEffect)(function(){d&&fe(d,"node",function(T){if(console.log("fetchRelationshipTypes within node mode: ",T),T.length>0){var p=M==null?void 0:M.map(function(h){var w=T.find(function(z){var te=z.label.split(" ")[1],re=h.label.split(" ")[1];return re===te});if(w)return w;var F=h.label.split(" ")[1];return{order:9999,label:"[".concat("0".padStart(4,"0"),"] ").concat(F),value:h.value}});console.log("Update the number of relationships: ",p),I(p==null?void 0:p.sort(function(h,w){return h.order-w.order}))}})},[d]);var fe=function(){var T=(0,zt.Z)((0,We.Z)().mark(function p(h,w,F){var z,te,re,he;return(0,We.Z)().wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:z="",te="",re="",w=="node"&&h?(z=':where [:or [:= :start_id "'.concat(h,`"]
                                  [:= :end_id "`).concat(h,'"]]'),te="[[:count :*] :ncount]",re="[[:ncount :desc]]"):w=="nodeType"&&h?(z=':where [:or [:= :source_type "'.concat(h,`"]
                                  [:= :target_type "`).concat(h,'"]]'),te="[[:count :*] :ncount]",re="[[:ncount :desc]]"):fail("Invalid query type or query string."),he=`
    {:select [`.concat(te,` [:_type :relationship_type] 
              [:source_type :source_type] [:target_type :target_type] 
              [:resource :resource]]
      :from :relationships
      `).concat(z,`
      :group-by [:relationship_type :source_type :target_type :resource]
      :order-by `).concat(re,`}
    `),(0,Ce.mc)({query_str:he,disable_total:"true"}).then(function(De){console.log("Get relationships: ",De);var Ye=[];if(De.data.length>0){var Me=Pn(De.data.map(function(Ae){return Ae.ncount}));De.data.forEach(function(Ae,qt){var ht=wn(Ae.relationship_type,Ae.resource,Ae.source_type,Ae.target_type);Ye.push({order:qt,label:"[".concat(Ae.ncount.toString().padStart(Me,"0"),"] ").concat(ht),value:ht})}),F(Ye)}else F([])}).catch(function(De){K.ZP.error("Get relationships error, please refresh the page and try again."),console.log("Get relationships error: ",De),F([])});case 6:case"end":return Ve.stop()}},p)}));return function(h,w,F){return T.apply(this,arguments)}}(),ie=function(){var T=(0,zt.Z)((0,We.Z)().mark(function p(h,w,F){var z;return(0,We.Z)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:Bt&&(clearTimeout(Bt),Bt=null),z=function(){C(!0),(0,Ce.g7)({query_str:Nn({id:w,name:w},{},{}),label_type:h}).then(function(Re){var Ve=Re.data,De=Ve.map(function(Me){return{value:Me.id,text:"".concat(Me.id," | ").concat(Me.name)}});console.log("getLabels results: ",De);var Ye=De.map(function(Me){return{label:Me.text,value:Me.value}});C(!1),F(Ye)}).catch(function(Re){console.log("requestNodes Error: ",Re),F([]),C(!1)})},Bt=setTimeout(z,300);case 3:case"end":return re.stop()}},p)}));return function(h,w,F){return T.apply(this,arguments)}}(),Le=function(p){Ne(void 0),G("Search ".concat(p," nodes ..."))},ke=function(p,h){h?ie(p,h,Ne):Ne(void 0)},ze=function(){$("")},R=function(){i.validateFields().then(function(p){if(console.log("onConfirm form values: ",p),t.onOk){var h,w=(0,m.Z)((0,m.Z)({},p),{},{all_relation_types:M?M.map(function(F){return F.value}):[],enable_prediction:p.enable_prediction?p.enable_prediction:!1,relation_types:p.relation_types?p.relation_types:[],nodes:(h=t.searchObject)===null||h===void 0?void 0:h.nodes});t.onOk(w)}}).catch(function(p){console.log("errorInfo: ",p)})},_e=l=="node",J=l=="batchIds",Q=l=="similarity",X=l=="batchNodes";return(0,e.jsxs)(ce.Z,{className:"query-form",layout:"horizontal",form:i,labelCol:{span:7},wrapperCol:{span:17},children:[(0,e.jsx)(ce.Z.Item,{name:"mode",label:"Mode",initialValue:"node",children:(0,e.jsxs)(ft.ZP.Group,{children:[(0,e.jsx)(ft.ZP,{value:"node",children:"Relationship"}),(0,e.jsx)(ft.ZP,{value:"batchIds",children:"Nodes"}),(0,e.jsx)(ft.ZP,{value:"similarity",children:"Similarity"}),((a=t.searchObject)===null||a===void 0?void 0:a.nodes)&&((n=t.searchObject)===null||n===void 0?void 0:n.nodes.length)>0&&(0,e.jsx)(ft.ZP,{value:"batchNodes",children:"BatchExpand"})]})}),(0,e.jsx)(ce.Z.Item,{label:"Node Type",name:"node_type",rules:[{required:!0,message:"Please select a node type."}],children:(0,e.jsx)(Ze.Z,{allowClear:!0,defaultActiveFirstOption:!1,showArrow:!0,placeholder:"Please select a node type",options:g,filterOption:!0,onSelect:Le})}),(0,e.jsx)(ce.Z.Item,{label:"Which Nodes",name:"node_ids",hidden:!J,rules:[{required:!!J,message:"Please enter your expected nodes."}],children:(0,e.jsx)(Ze.Z,{showSearch:!0,allowClear:!0,loading:D,mode:"multiple",defaultActiveFirstOption:!1,showArrow:!0,placeholder:ue,onSearch:function(p){return ke(f,p)},options:ge,filterOption:!1,notFoundContent:(0,e.jsx)(Ee.Z,{description:D?"Searching...":ge!==void 0?"Not Found":"Enter your interested ".concat(f," ...")})})}),(0,e.jsx)(ce.Z.Item,{label:"Which Node",name:"node_id",hidden:J||X,rules:[{required:!(J||X),message:"Please enter your expected node."}],children:(0,e.jsx)(Ze.Z,{showSearch:!0,allowClear:!0,loading:D,defaultActiveFirstOption:!1,showArrow:!0,placeholder:ue,onSearch:function(p){return ke(f,p)},options:ge,filterOption:!1,notFoundContent:(0,e.jsx)(Ee.Z,{description:D?"Searching...":ge!==void 0?"Not Found":"Enter your interested ".concat(f," ...")})})}),(0,e.jsx)(ce.Z.Item,{name:"relation_types",label:"Relation Types",hidden:J||Q,validateStatus:U?"warning":"",help:U,rules:[{required:!1,message:"Please select your expected relation types!",type:"array"}],children:(0,e.jsx)(Ze.Z,{mode:"multiple",onChange:ze,filterOption:function(p,h){return h.label.toLowerCase().indexOf(p.toLowerCase())>=0},allowClear:!0,autoClearSearchValue:!1,placeholder:"Please select relation types",options:M})}),(0,e.jsx)(ce.Z.Item,{label:"Query Mode",name:"query_mode",hidden:!X,children:(0,e.jsx)(Ze.Z,{placeholder:"Please select query mode",options:qr})}),(0,e.jsx)(ce.Z.Item,{name:"nsteps",label:"Num of Steps",hidden:J||Q||X,rules:[{required:!1,message:"Please select your expected nsteps",type:"number"}],children:(0,e.jsx)(Ze.Z,{placeholder:"Please select nsteps",options:eo})}),(0,e.jsx)(ce.Z.Item,{name:"limit",label:"Max Num of Nodes",hidden:J||Q,rules:[{required:!1,message:"Please input your expected value",type:"number"}],children:(0,e.jsx)(Wn.Z,{min:1,max:500})}),(0,e.jsx)(ce.Z.Item,{label:"Enable Prediction",name:"enable_prediction",hidden:J||Q||X,valuePropName:"checked",children:(0,e.jsx)(me.Z,{})}),(0,e.jsx)(ce.Z.Item,{name:"topk",label:"Top K",hidden:J||X,rules:[{required:!1,message:"Please input your expected value",type:"number"}],children:(0,e.jsx)(Wn.Z,{min:1,max:100})}),(0,e.jsx)(ce.Z.Item,{label:"Merging Mode",name:"merge_mode",children:(0,e.jsx)(Ze.Z,{placeholder:"Please select mode for merging nodes & relationships",options:Xr})}),(0,e.jsxs)(ce.Z.Item,{wrapperCol:{offset:19,span:5},children:[(0,e.jsx)(W.Z,{style:{marginRight:"10px"},onClick:t.onCancel,children:"Cancel"}),(0,e.jsx)(W.Z,{type:"primary",onClick:R,children:"Search"})]})]})},no=to,ao=function(t){return(0,e.jsxs)("div",{className:"question-queryer",children:[(0,e.jsx)("h3",{children:"Question:"}),(0,e.jsx)(Ft.Z.TextArea,{rows:4,placeholder:"Please input your question",maxLength:6}),(0,e.jsx)("h3",{children:"Query (generated by AI):"}),(0,e.jsx)(Ft.Z.TextArea,{rows:4,placeholder:"Wait for your input...",maxLength:6}),(0,e.jsxs)("div",{className:"button-group",children:[(0,e.jsx)(W.Z,{onClick:t.onCancel,children:"Cancel"}),(0,e.jsx)(W.Z,{type:"primary",onClick:function(){t.onOk&&t.onOk({})},children:"Search"})]})]})},ro=ao,oo=function(t){var a=(0,s.useState)("single"),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)([]),l=(0,y.Z)(i,2),d=l[0],f=l[1],x=[{label:"Single Query",key:"single",children:(0,e.jsx)(no,{edgeStat:t.edgeStat,onCancel:t.onCancel,onOk:t.onOk,searchObject:t.searchObject})},{label:"Batch Query",key:"batch",children:(0,e.jsx)($r,{dataSource:d,onOk:t.onOk,onCancel:t.onCancel})},{label:"Ask Question",key:"question",children:(0,e.jsx)(ro,{onCancel:t.onCancel,onOk:t.onOk})}];return(0,e.jsx)(st.Z,{className:"advanced-search",title:"Advanced Search",onCancel:t.onCancel,open:t.visible,destroyOnClose:!0,footer:null,getContainer:t.parent?t.parent:document.body,children:(0,e.jsx)(ve.Z,{defaultActiveKey:"single",activeKey:o,tabPosition:"left",items:x,destroyInactiveTabPane:!0,onChange:function(j){r(j)},tabBarExtraContent:o==="batch"?(0,e.jsx)(Jr,{onUpload:function(j){f(j)}}):null})})},io=oo,Kn=u(25478),lo=u(66979),so=u.n(lo),co=u(58660),uo=u(74310),fo=u(75503),ho=function(t){var a=t.plotlyData,n=t.handleUpdate,o=t.mode,r=(0,s.useRef)(null),i=function(g,Z,E){n&&n({data:g,layout:Z,frames:E})},l=function(g,Z,E){n&&n({data:g,layout:Z,frames:E})},d=function(){console.log("PlotlyViewer handleResize: ",t.forceResize,r);var g=document.querySelector("#".concat(t.divId));t.divId&&t.forceResize&&g&&Kn.relayout(t.divId,{autosize:!0})};(0,s.useEffect)(function(){if(t.divId&&t.forceResize){var b=document.querySelector("#".concat(t.divId)),g=new ResizeObserver(function(Z){var E=(0,$e.Z)(Z),k;try{for(E.s();!(k=E.n()).done;){var D=k.value;console.log("Element size changed to ".concat(D.contentRect.width,"x").concat(D.contentRect.height)),D.target==b&&(console.log("Parent size changed"),d())}}catch(C){E.e(C)}finally{E.f()}});return b&&g.observe(b),function(){return g.disconnect()}}else return function(){}},[r]);var f={toImageButtonOptions:{format:"svg",filename:"custom_image",height:1e3,width:1e3,scale:1},editable:!0,scrollZoom:!1,displaylogo:!1,displayModeBar:!0,showTips:!0,responsive:!0,locales:{"zh-CN":fo},locale:(0,uo.Kd)()};console.log("PlotlyViewer updated: ",t);var x=a||{data:[],layout:{}},S=x.data,j=x.layout,v=x.frames;return j=(0,m.Z)((0,m.Z)({},j),{},{margin:{t:50,r:50,b:50,l:50}}),o==="Plotly"?(0,e.jsx)(co.Z,{ref:r,divId:t.divId,useResizeHandler:!0,className:"plotly-viewer",data:S,layout:(0,m.Z)((0,m.Z)({},j),{},{autosize:!0}),config:f,onClick:t.onClick,frames:v}):(0,e.jsx)("div",{className:"plotly-editor",children:(0,e.jsx)(so(),{ref:r,divId:t.divId,data:S,layout:(0,m.Z)((0,m.Z)({},j),{},{autosize:!0}),config:f,frames:v,plotly:Kn,onClick:t.onClick,onUpdate:i,onRender:l,useResizeHandler:!0,advancedTraceTypeSelector:!0})})},Ut=(0,s.memo)(ho),Ke=function(t,a,n,o){return{title:{text:t,font:{family:"Arial",size:"1.3rem",color:"#333333"},xref:"paper",x:0},xaxis:{zeroline:!0,zerolinecolor:"#333333",zerolinewidth:1,tickangle:315,title:{text:a,font:{family:"Arial",size:"1.1rem",color:"#333333"}},tickfont:{family:"Arial",size:"1rem",color:"#333333"},showgrid:!1,margin:{l:50,r:50,b:50,t:50,pad:4},automargin:o},yaxis:{title:{text:n,font:{family:"Arial",size:"1.1rem",color:"#333333"}},tickfont:{family:"Arial",size:"1rem",color:"#333333"},showgrid:!1,zeroline:!0,zerolinecolor:"#333333",zerolinewidth:1,margin:{l:50,r:50,b:50,t:50,pad:4},automargin:o},plot_bgcolor:"#ffffff",paper_bgcolor:"#ffffff"}},vo=function(t){var a=t.data,n=(0,s.useState)([]),o=(0,y.Z)(n,2),r=o[0],i=o[1];(0,s.useEffect)(function(){if(a.nodes.length!==0){var d=a.nodes,f=a.edges,x=(0,N.uniqBy)(d,"nlabel").map(function(g){return g.nlabel}),S=(0,N.uniqBy)(f,"reltype").map(function(g){return g.reltype}),j=x.map(function(g){return{type:g,count:d.filter(function(Z){return Z.nlabel===g}).length}}),v=S.map(function(g){return{type:g,count:f.filter(function(Z){return Z.reltype===g}).length}}),b=[];b.push({data:[{x:j.map(function(g){return g.type}),y:j.map(function(g){return g.count}),type:"bar",name:"Node Type Count",marker:{color:"#0083ff"}}],layout:Ke("Node Type Count","Node Type","Count",!1)}),b.push({data:[{x:v.map(function(g){return g.type}),y:v.map(function(g){return g.count}),type:"bar",name:"Edge Type Count",marker:{color:"#0083ff"}}],layout:Ke("Edge Type Count","Edge Type","Count",!1)}),i(b)}},[a]);var l=function(f){for(var x="",S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",j=S.length,v=0;v<f;)x+=S.charAt(Math.floor(Math.random()*j)),v+=1;return x};return(0,e.jsx)(q.Z,{className:"complex-chart",children:r.length===0?(0,e.jsx)(be.Z,{span:24,children:(0,e.jsx)(Ee.Z,{})}):r.map(function(d,f){return(0,e.jsx)(be.Z,{span:12,style:{height:"400px"},children:(0,e.jsx)(Ut,{mode:"Plotly",plotlyData:d,divId:"".concat(l(5)),forceResize:!0})},f)})})},po=vo,El=u(7359),Xt=u(27279),Wt=function(t,a){return t.reduce(function(n,o){return(n[o[a]]=n[o[a]]||[]).push(o),n},{})},Hn=function(t,a,n,o){return t.forEach(function(r){r[o]=r[a]+"_"+r[n]}),t},go=function(t,a,n,o){var r=t.reduce(function(i,l){var d="".concat(l[a],"-").concat(l[n]);if(!i[d]){var f;i[d]=(f={},(0,Qe.Z)(f,a,l[a]),(0,Qe.Z)(f,n,l[n]),(0,Qe.Z)(f,o,0),f)}return i[d][o]+=l[o],i},{});return Object.values(r)},$n=function(t,a,n,o){var r=Object.values(t.reduce(function(i,l){var d=Ue.Z.snakeCase(l[a]);if(!i[d]){var f={};f[a]=l[a],i[d]=f}var x=Ue.Z.snakeCase(l[n]);return i[d][x]=l[o],i},{}));return r},Qn=function(t){return t.reduce(function(a,n){return n.map(function(o,r){return(a[r]||[]).concat(n[r])})},[])},mo=function(t){var a=t.nodeStat,n=t.edgeStat,o=(0,s.useState)([]),r=(0,y.Z)(o,2),i=r[0],l=r[1],d=(0,s.useState)([]),f=(0,y.Z)(d,2),x=f[0],S=f[1];(0,s.useEffect)(function(){if(a.length!==0&&n.length!==0){var v=[],b=a.reduce(function(G,Y){return G+Y.node_count},0),g=n.reduce(function(G,Y){return G+Y.relation_count},0);console.log("Node Count: ",b,"Edge Count: ",g),v.push({data:[{labels:["Node Count","Edge Count"],values:[b,g],type:"pie",textinfo:"value"}],layout:(0,m.Z)({},Ke("Total Count","Type","Count",!0))});var Z=Wt(a,"source"),E=Object.keys(Z).map(function(G){return{x:Z[G].map(function(Y){return Y.node_type}),y:Z[G].map(function(Y){return Y.node_count}),type:"bar",name:G}});v.push({data:E,layout:(0,m.Z)((0,m.Z)({},Ke("Node Count","Node Type","Count",!0)),{},{barmode:"stack"})}),Z=Wt(a,"node_type"),E=Object.keys(Z).map(function(G){return{x:Z[G].map(function(Y){return Y.source}),y:Z[G].map(function(Y){return Y.node_count}),type:"bar",name:G}}),v.push({data:E,layout:(0,m.Z)((0,m.Z)({},Ke("Node Count","Source","Count",!0)),{},{barmode:"stack"})});var k=Wt(Hn(n,"start_node_type","end_node_type","rel"),"rel"),D=Object.keys(k).map(function(G){return{x:k[G].map(function(Y){return Y.source}),y:k[G].map(function(Y){return Y.relation_count}),type:"bar",name:G}});v.push({data:D,layout:(0,m.Z)((0,m.Z)({},Ke("Relation Count","Source","Count",!0)),{},{barmode:"stack"})}),k=Wt(Hn(n,"start_node_type","end_node_type","rel"),"source"),D=Object.keys(k).map(function(G){return{x:k[G].map(function(Y){return Y.rel}),y:k[G].map(function(Y){return Y.relation_count}),type:"bar",name:G}}),v.push({data:D,layout:(0,m.Z)((0,m.Z)({},Ke("Relation Count","Relationship Type","Count",!0)),{},{barmode:"stack"})}),l(v);var C="grey",O="lightgrey",_="white",M=[],I=$n(a,"node_type","source","node_count"),L=Array.from(new Set(a.map(function(G){return G.source}))),B=Qn(I.map(function(G){var Y=[G.node_type];return Y.concat(L.map(function(ye){var ge=Ue.Z.snakeCase(ye);return G[ge]===void 0?0:G[ge]}))})),U=B[0].length,$=Array.from({length:U},function(G,Y){return Y%2==0?O:_}),se={type:"table",header:{values:["Node Type"].concat(L),align:["center","center"],line:{width:1,color:"black"},fill:{color:C},font:{family:"Arial",size:12,color:"white"}},cells:{values:B,align:["center","center"],line:{color:"black",width:1},fill:{color:[$]},font:{family:"Arial",size:11,color:["black"]},height:30,format:[[void 0,void 0],[void 0,",d"]]}};console.log("Table: ",se,I,L,B),M.push({data:[se],layout:{title:"Node Count"}});var Se=go(n,"source","relation_type","relation_count");I=$n(Se,"relation_type","source","relation_count"),L=Array.from(new Set(n.map(function(G){return G.source}))),B=Qn(I.map(function(G){var Y=[G.relation_type];return Y.concat(L.map(function(ye){var ge=Ue.Z.snakeCase(ye);return G[ge]===void 0?0:G[ge]}))})),U=B[0].length,$=Array.from({length:U},function(G,Y){return Y%2==0?O:_});var ue={type:"table",header:{values:["Relationship Type"].concat(L),align:["center","center"],line:{width:1,color:"black"},fill:{color:C},font:{family:"Arial",size:12,color:"white"}},cells:{values:B,align:["center","center"],line:{color:"black",width:1},fill:{color:[$]},font:{family:"Arial",size:11,color:["black"]},height:30,format:[[void 0,void 0],[void 0,",d"]]},columnwidth:Array.from({length:L.length},function(G,Y){return Y==0?150:50})};console.log("Table: ",ue,I,L,B),M.push({data:[ue],layout:{title:"Relationship Count"}}),S(M)}},[a,n]);var j=function(b){for(var g="",Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",E=Z.length,k=0;k<b;)g+=Z.charAt(Math.floor(Math.random()*E)),k+=1;return g};return(0,e.jsxs)(Xt.Z,{defaultActiveKey:["charts","tables"],children:[(0,e.jsx)(Xt.Z.Panel,{header:"Charts",children:(0,e.jsx)(q.Z,{className:"complex-chart",children:i.length===0?(0,e.jsx)(be.Z,{span:24,children:(0,e.jsx)(Ee.Z,{})}):i.map(function(v,b){return(0,e.jsx)(be.Z,{span:12,style:{height:"350px",marginBottom:"10px"},children:(0,e.jsx)(Ut,{mode:"Plotly",plotlyData:v,divId:"".concat(j(5)),forceResize:!0})},b)})})},"charts"),(0,e.jsx)(Xt.Z.Panel,{header:"Tables",children:(0,e.jsx)(q.Z,{className:"complex-chart",children:x.length===0?(0,e.jsx)(be.Z,{span:24,children:(0,e.jsx)(Ee.Z,{})}):x.map(function(v,b){return(0,e.jsx)(be.Z,{span:24,style:{height:"350px",marginBottom:"10px"},children:(0,e.jsx)(Ut,{mode:"Plotly",plotlyData:v,divId:"".concat(j(5)),forceResize:!0})},b)})})},"tables")]})},yo=mo,xo=function(t){var a=t.node,n=(0,s.useState)(void 0),o=(0,y.Z)(n,2),r=o[0],i=o[1];return(0,s.useEffect)(function(){},[a]),(0,e.jsxs)(ve.Z,{className:"disease-info-panel",children:[(0,e.jsx)(ve.Z.TabPane,{tab:"Disease Info",children:"Comming Soon..."},"disease-info"),(0,e.jsx)(ve.Z.TabPane,{tab:"Clinical Trials",children:(0,e.jsx)("img",{width:"100%",src:"/examples/clinical-trials.png"})},"clinical-trails")]})},So=xo,Zo=function(t){var a=t.node,n=(0,s.useState)(void 0),o=(0,y.Z)(n,2),r=o[0],i=o[1];return(0,s.useEffect)(function(){},[a]),(0,e.jsxs)(ve.Z,{className:"drug-info-panel",children:[(0,e.jsx)(ve.Z.TabPane,{tab:"Drug Info",children:"Comming Soon..."},"drug-info"),(0,e.jsx)(ve.Z.TabPane,{tab:"3D Structure",children:"Comming Soon..."},"drug-3d")]})},bo=Zo,Co=u(95093),jo=function(){var c=(0,zt.Z)((0,We.Z)().mark(function t(a){var n,o,r;return(0,We.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Co.Z.get("https://mygene.info/v3/gene/".concat(a));case 2:return n=l.sent,o=n.data,r={_id:o._id,_version:o._version,entrezgene:o.entrezgene,hgnc:o.HGNC,name:o.name,symbol:o.symbol,taxid:o.taxid,type_of_gene:o.type_of_gene,summary:o.summary,ensembl:{gene:o.ensembl.gene,transcript:o.ensembl.transcript,protein:o.ensembl.protein,translation:o.ensembl.translation},genomic_pos:{chr:o.genomic_pos.chr,start:o.genomic_pos.start,end:o.genomic_pos.end,strand:o.genomic_pos.strand}},l.abrupt("return",r);case 6:case"end":return l.stop()}},t)}));return function(a){return c.apply(this,arguments)}}(),No=function(t){var a=(0,s.useState)(""),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)(""),l=(0,y.Z)(i,2),d=l[0],f=l[1];return(0,s.useEffect)(function(){t.geneSymbol&&f("https://omics-data.3steps.cn/fetch/expression_atlas?geneSymbol=".concat(t.geneSymbol,"&taxId=").concat(t.taxId||9606))},[t.geneSymbol]),(0,s.useEffect)(function(){t.rootId?r(t.rootId):r("expression_atlas")},[]),(0,e.jsx)("iframe",{id:o,title:"Expression Atlas",src:d,style:{width:"100%",height:"100%",border:"none",minHeight:"1000px"}})},ko=No,wo=function(t){var a=(0,s.useState)(""),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)(""),l=(0,y.Z)(i,2),d=l[0],f=l[1];return(0,s.useEffect)(function(){t.geneSymbol&&f("https://omics-data.3steps.cn/fetch/gene_cards?geneSymbol=".concat(t.geneSymbol,"&taxId=").concat(t.taxId||9606))},[t.geneSymbol]),(0,s.useEffect)(function(){t.rootId?r(t.rootId):r("gene-info")},[]),(0,e.jsx)("iframe",{id:o,title:"Gene Information",src:d,style:{width:"100%",height:"100%",border:"none",minHeight:"1000px"}})},Eo=wo,at=u(88902),Po="Overall, this table provides insights into the tissue-specific expression pattern of the PRG4 gene in human tissues, as well as the specific transcript variants that are expressed in each tissue. The median expression levels suggest that PRG4 is highly expressed in some tissues, such as Adipose_Visceral_Omentum and Artery_Tibial, but not expressed or expressed at very low levels in other tissues, such as Bladder and Brain_Amygdala. The information in this table can be used to gain a better understanding of the role of PRG4 in different tissues and may be useful in designing future studies investigating the gene's function in health and disease.",Io=function(t){var a=(0,s.useState)(""),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)(Po),l=(0,y.Z)(i,2),d=l[0],f=l[1];return(0,s.useEffect)(function(){t.rootId?r(t.rootId):r("gtex-viewer")},[]),(0,e.jsxs)("div",{className:"gtex-viewer",children:[(0,e.jsxs)("div",{className:"summary",children:[(0,e.jsx)("h3",{className:"summary-title",children:"Summary [Summarized by AI]"}),(0,e.jsx)("p",{className:"summary-content",children:d})]}),t.type=="transcript"?(0,e.jsxs)("div",{className:"transcript-figures",children:[(0,e.jsx)(at.E7,{rootId:o+"-isoform-transposed",type:"isoformTransposed",title:t.title||"Isoform Transposed",geneId:t.officialGeneSymbol}),(0,e.jsx)(at.E7,{rootId:o+"-exon",title:t.title||"Exon",type:"exon",geneId:t.officialGeneSymbol}),(0,e.jsx)(at.E7,{rootId:o+"-junction",title:t.title||"Junction",type:"junction",geneId:t.officialGeneSymbol})]}):null,t.type=="gene"?(0,e.jsxs)("div",{className:"gene-figures",children:[(0,e.jsx)(at.hK,{rootId:o+"boxplot",title:t.title||"Boxplot",geneId:t.officialGeneSymbol}),(0,e.jsx)(at.UA,{rootId:o+"violin",title:t.title||"Violin Plot",geneId:t.officialGeneSymbol})]}):null]})},_n=Io,To=function(){return(0,e.jsx)("div",{children:(0,e.jsx)("img",{width:"100%",src:"/examples/molstar.png"})})},Do=To,Mo=u(69610),Go=u(54941),Oo=u(81306),Lo=u(59206),Ro=u(24753),Ao=[{codon:858,count:23,tooltip:{header:"Title",body:"Description"},color:"#008000",id:"variant-id-001",label:{text:"L858R",textAnchor:"middle",fontSize:10,fontFamily:"arial"},selected:!0},{codon:746,count:17,tooltip:{header:"Title",body:"Description"},color:"#993404",selected:!0},{codon:861,count:5,tooltip:{header:"Title",body:"Description"},color:"#008000"},{codon:747,count:5,tooltip:{header:"Title",body:"Description"},color:"#993404",selected:!1},{codon:768,count:3,tooltip:{header:"Title",body:"Description"},color:"#008000"},{codon:754,count:3,tooltip:{header:"Title",body:"Description"},color:"#008000"},{codon:719,count:3,tooltip:{header:"Title",body:"Description"},color:"#008000"},{codon:709,count:3,tooltip:{header:"Title",body:"Description"},color:"#993404"},{codon:833,count:2,tooltip:{header:"Title",body:"Description"},color:"#008000"},{codon:1,count:1,tooltip:{header:"Title",body:"Description"},color:"#cf58bc"}],Fo=[{startCodon:57,endCodon:167,label:"Recep_L_domain",color:"#2dcf00",tooltip:{header:"Recep_L_domain",body:"Recep_L_domain (57 - 167)"}},{startCodon:185,endCodon:338,label:"Furin-like",color:"#ff5353",tooltip:{header:"Furin-like"}},{startCodon:361,endCodon:480,label:"Recep_L_domain",color:"#2dcf00"},{startCodon:505,endCodon:636,label:"GF_recep_IV",color:"#5b5bff",tooltip:{header:"Title",body:"Description"}},{startCodon:713,endCodon:965,label:"Pkinase_Tyr",color:"#ebd61d",tooltip:{header:"Title",body:"Description"}}],Pl=function(c){(0,Oo.Z)(a,c);var t=(0,Lo.Z)(a);function a(){return(0,Mo.Z)(this,a),t.apply(this,arguments)}return(0,Go.Z)(a,[{key:"render",value:function(){return(0,e.jsx)(Ro.Z,{domains:Fo,lollipops:Ao,vizWidth:1e3,vizHeight:300,hugoGeneSymbol:"PRG4",xMax:1e3,yMax:300,onLollipopClick:function(){}})}}]),a}(s.Component),Il=null,zo=function(t){var a=(0,s.useState)(""),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)(""),l=(0,y.Z)(i,2),d=l[0],f=l[1];return(0,s.useEffect)(function(){t.geneSymbol&&f("https://omics-data.3steps.cn/fetch/sanger_cosmic?geneSymbol=".concat(t.geneSymbol,"&taxId=").concat(t.taxId||9606))},[t.geneSymbol]),(0,s.useEffect)(function(){t.rootId?r(t.rootId):r("sanger-cosmic")},[]),(0,e.jsx)("iframe",{id:o,title:"Cosmic Mutations",src:d,style:{width:"100%",height:"100%",border:"none",minHeight:"1000px"}})},Vo=zo,Bo=function(t){var a=(0,s.useState)(""),n=(0,y.Z)(a,2),o=n[0],r=n[1];return(0,s.useEffect)(function(){t.rootId?r(t.rootId):r("grna-selector")},[]),(0,e.jsx)(at.tB,{geneId:"".concat(t.geneId),id:o})},Uo=Bo,Tl=u(42877),Wo=function(t){var a,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],o=(a=t.ensembl)===null||a===void 0?void 0:a.gene,r=t.symbol,i=t.entrezgene,l=[{label:"Summary",key:"summary",children:(0,e.jsx)(Eo,{geneSymbol:r})},{label:"Gene",key:"gene",children:(0,e.jsx)(_n,{officialGeneSymbol:o,type:"gene"})},{label:"Transcript",key:"transcript",children:(0,e.jsx)(_n,{officialGeneSymbol:o,type:"transcript"})},{label:"Expression Atlas",key:"expression-atlas",children:(0,e.jsx)(ko,{geneSymbol:r})},{label:"Mutation",key:"mutation",children:(0,e.jsx)(Vo,{geneSymbol:r})},{label:"3D Structure",key:"structure",children:(0,e.jsx)(Do,{})},{label:"Preferred sgRNAs",key:"preferred-sgrnas",children:(0,e.jsx)(Uo,{geneId:i})}];return l.filter(function(d){return!n.includes(d.key)})},Ko=function(t){var a=t.node,n=(0,s.useState)(void 0),o=(0,y.Z)(n,2),r=o[0],i=o[1],l=(0,s.useState)([{label:"Summary",key:"summary",checked:!0},{label:"Gene",key:"gene",checked:!0},{label:"Transcript",key:"transcript",checked:!0},{label:"Mutation",key:"mutation",checked:!0},{label:"3D Structure",key:"structure",checked:!0},{label:"Sgrna",key:"sgrna",checked:!0}]),d=(0,y.Z)(l,2),f=d[0],x=d[1],S=(0,s.useState)([]),j=(0,y.Z)(S,2),v=j[0],b=j[1];(0,s.useEffect)(function(){a&&jo(a.data.id).then(function(E){i(E),b(Wo(E,(0,N.filter)(f,function(k){return!k.checked})))}).catch(function(E){console.log("getGeneInfo Error: ",E),i(void 0)})},[a,f]);var g=function(){var k=function(C){var O=C.target,_=O.checked,M=O.value;x(_?(0,N.map)(f,function(I){return I.key===M&&(I.checked=!0),I}):(0,N.map)(f,function(I){return I.key===M&&(I.checked=!1),I}))};return(0,e.jsx)("div",{children:v.map(function(D){return(0,e.jsxs)("div",{children:[(0,e.jsx)("input",{type:"checkbox",defaultChecked:D.checked,value:D.key,onChange:k}),"\xA0",(0,e.jsx)("span",{children:D.label})]},D.key)})})},Z=(0,e.jsx)(gn.Z,{content:g(),children:(0,e.jsx)(W.Z,{shape:"circle",className:"tabs-extra-button",icon:(0,e.jsx)(tt.Z,{})})});return(0,e.jsx)(ve.Z,{className:"gene-info-panel tabs-nav-right",tabBarExtraContent:{left:Z,right:null},items:v})},Ho=Ko,$o=function(t){var a=t.node,n=function(r){if(r){var i=r.nlabel.toLocaleLowerCase();if(["gene","protein"].includes(i))return(0,e.jsx)(Ho,{node:r});if(["drug","chemical","compound"].includes(i))return(0,e.jsx)(bo,{node:r});if(["disease"].includes(i))return(0,e.jsx)(So,{node:r})}return(0,e.jsx)(Ee.Z,{})};return(0,e.jsx)(q.Z,{className:"node-info-panel",children:n(a)})},Qo=$o,_o=function(t){var a=t.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},n=a.edge,o=a.startNode,r=a.endNode;return(0,s.useEffect)(function(){},[n,o,r]),(0,e.jsxs)(ve.Z,{className:"drug-gene-info-panel",children:[(0,e.jsx)(ve.Z.TabPane,{tab:"DrugGene Info",children:"We can show the drug-gene association information here. Maybe it's summarized information from publications."},"drug-gene-info"),(0,e.jsx)(ve.Z.TabPane,{tab:"Drug Targets",children:"Comming soon..."},"clinical-trails")]})},Yo=_o,Jo=function(t){var a=t.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},n=a.edge,o=a.startNode,r=a.endNode;return(0,s.useEffect)(function(){},[n,o,r]),(0,e.jsxs)(ve.Z,{className:"drug-disease-info-panel tabs-nav-right",children:[(0,e.jsx)(ve.Z.TabPane,{tab:"DrugDisease Info",children:"We can show the drug-disease association information here. Maybe it's summarized information from clinical trials, or publications."},"drug-disease-info"),(0,e.jsx)(ve.Z.TabPane,{tab:"Patents",children:"We can show the patents information here. Maybe it's summarized information from patents database."},"drug-patent-info"),(0,e.jsx)(ve.Z.TabPane,{tab:"Products",children:"We can show the production information here. Maybe it's summarized information from drug production database."},"drug-product-info")]})},Xo=Jo,qo=function(t){var a=t.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},n=a.edge,o=a.startNode,r=a.endNode;return(0,s.useEffect)(function(){console.log("GeneDiseasePanel: ",n,o,r)},[n,o,r]),(0,e.jsxs)(ve.Z,{className:"gene-disease-info-panel tabs-nav-right",children:[(0,e.jsx)(ve.Z.TabPane,{tab:"GeneDiease Info",children:"We can show the gene-disease association information here. Maybe it's summarized information from publications."},"gene-disease-info"),(0,e.jsx)(ve.Z.TabPane,{tab:"Diff Expression",children:"we can show the diff expression here. It can tell us whether the gene is up-regulated or down-regulated in the disease."},"diff-expr"),(0,e.jsx)(ve.Z.TabPane,{tab:"Biomarkers",children:"we can show the related biomarkers. It can tell us which genes are the biomarkers of the disease."},"biomarker")]})},ei=qo,ti=function(t){var a=t.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},n=a.edge,o=a.startNode,r=a.endNode,i=(0,s.useState)("Unknown"),l=(0,y.Z)(i,2),d=l[0],f=l[1],x=function(j){switch(console.log("whichPanel: ",j),j){case"DrugDisease":return(0,e.jsx)(Xo,{edgeInfo:t.edgeInfo});case"DrugGene":return(0,e.jsx)(Yo,{edgeInfo:t.edgeInfo});case"GeneDisease":return(0,e.jsx)(ei,{edgeInfo:t.edgeInfo});default:return(0,e.jsx)(Ee.Z,{})}};return(0,s.useEffect)(function(){if(console.log("EdgeInfoPanel: ",n,o,r),n&&o&&r){var S=o.nlabel,j=r.nlabel,v=[S,j].sort().join("");console.log("relationTypes: ",v,d),f(""),["CompoundDisease","ChemicalDisease","DiseaseDrug"].indexOf(v)>=0&&f("DrugDisease"),["DiseaseGene","GeneDisease"].indexOf(v)>=0&&f("GeneDisease"),["CompoundGene","ChemicalGene","DrugGene"].indexOf(v)>=0&&f("DrugGene")}},[n,o,r]),(0,e.jsx)(q.Z,{className:"edge-info-panel",children:x(d)})},ni=ti,Dl=u(32157),ai=u(82363),ri=function(t){var a={name:"file",action:"/api/upload",showUploadList:!1,beforeUpload:function(o){var r=new FileReader;return r.readAsText(o),r.onload=function(){try{var i=JSON.parse(r.result);t.onUpload&&t.onUpload(i)}catch(l){Yt.Z.error({message:"Failed to parse file",description:"Please make sure the file is a valid JSON file"})}},r.onerror=function(i){K.ZP.error("Failed to read file")},!1}};return(0,e.jsx)(Bn.Z,(0,m.Z)((0,m.Z)({},a),{},{children:(0,e.jsx)(W.Z,{icon:(0,e.jsx)(Un.Z,{}),children:"Upload"})}))},oi=ri,ii=ai.Z.DirectoryTree,li=function(t){var a={};t.forEach(function(i){a[i.id]=i});var n=[];t.forEach(function(i){if(console.log("parent: ",i.parent,"id: ",i.id),i.parent===i.id){var l=(0,m.Z)((0,m.Z)({},i),{},{title:i.name,key:i.id});n.push(l)}else{var d=a[i.parent];d&&(d.children=d.children||[],d.children.push((0,m.Z)((0,m.Z)({},i),{},{title:i.name+"-"+i.id.slice(0,8),key:i.id,isLeaf:!0})))}});var o=function i(l){var d=[];return l.forEach(function(f){f.children?d=d.concat(i(f.children).concat([(0,m.Z)((0,m.Z)({},f),{},{children:void 0})])):d.push(f)}),d},r=[];return n.forEach(function(i){i.children?i.children=o(i.children).concat((0,m.Z)((0,m.Z)({},i),{},{children:void 0})):i.children=[(0,m.Z)((0,m.Z)({},i),{},{children:void 0})],r.push(i)}),console.log("makeTree",t,a,n,r),r},si=function(t){var a=6,n=s.useState([]),o=(0,y.Z)(n,2),r=o[0],i=o[1],l=s.useState([]),d=(0,y.Z)(l,2),f=d[0],x=d[1],S=s.useState([]),j=(0,y.Z)(S,2),v=j[0],b=j[1],g=s.useState(a),Z=(0,y.Z)(g,2),E=Z[0],k=Z[1],D=[{title:"Name",dataIndex:"name",key:"name",align:"center",width:150,fixed:"left"},{title:"Created At",dataIndex:"created_time",key:"created_time",align:"center",render:function(M){return new Date(M).toLocaleString()},width:200},{title:"Version",key:"version",align:"center",dataIndex:"version",width:100},{title:"UUID",key:"id",align:"center",dataIndex:"id",width:200},{title:"DB Version",key:"db_version",align:"center",dataIndex:"db_version",width:150},{title:"Action",key:"action",align:"center",fixed:"right",width:240,render:function(M,I,L){return(0,e.jsxs)(Jt.Z,{size:"small",children:[(0,e.jsxs)(W.Z,{size:"small",type:"link",disabled:t.selectedGraphId===I.id,onClick:function(U){if(v){var $=v[L];$&&t.onLoad(I,$)}else console.log("GraphTable load: something wrong.",v,L,I),t.onLoad(I,I)},children:["Load",t.selectedGraphId===I.id?"ed":""]}),(0,e.jsx)(W.Z,{size:"small",type:"link",onClick:function(U){var $=JSON.stringify(I),se=new Blob([$],{type:"application/json"}),Se=URL.createObjectURL(se),ue=document.createElement("a");ue.href=Se,ue.download=I.name+".json",document.body.appendChild(ue),ue.click(),document.body.removeChild(ue)},children:"Download"}),(0,e.jsx)(W.Z,{size:"small",type:"link",danger:!0,onClick:function(U){return t.onDelete(I)},children:"Delete"})]})}}],C=function(M,I){if(console.log("Trigger Select",M,I),I.selectedNodes[0]&&I.selectedNodes[0].children){var L=I.selectedNodes[0];b(L.children),x(M)}else x([]),b([])},O=function(M,I){console.log("Trigger Expand",M,I)};return(0,s.useEffect)(function(){if(t.treeFormat){var _=li(t.graphs);i(_);var M=_[0]?_[0].children:[];b(M),k(a),x(_[0]?[_[0].key]:[])}else b(t.graphs),k(0)},[t.graphs]),(0,e.jsx)(st.Z,{className:"graph-table",title:"Graph Table",open:t.visible,width:1e3,closable:!0,onCancel:t.onClose,getContainer:t.parent?t.parent:document.body,footer:t.onUpload?[(0,e.jsx)(oi,{onUpload:function(M){if(t.onUpload){var I=M;delete I.parent,delete I.created_time,t.onUpload(I)}}},"upload-graph")]:null,children:(0,e.jsxs)(q.Z,{gutter:16,children:[(0,e.jsx)(be.Z,{span:E,children:t.treeFormat?(0,e.jsx)(ii,{defaultExpandAll:!0,selectedKeys:f,onSelect:C,onExpand:O,treeData:r,fieldNames:{title:"title",key:"key",children:"notShown"}}):null}),(0,e.jsx)(be.Z,{span:24-E,children:(0,e.jsx)(He.Z,{rowKey:"id",columns:D,dataSource:v,pagination:!1,scroll:{y:500,x:800},size:"small",expandable:{expandedRowRender:function(M){return(0,e.jsx)("p",{style:{margin:0},children:M.description||"No description"})},rowExpandable:function(M){return M.name!=="Not Expandable"}}})})]})})},di=si,ci=u(17566),ui=function(t){var a=(0,s.useContext)(Pe.Z),n=a.graph,o=function(l){if(t.payload)if(n){console.log("Save graph data which are from graphin.");var d=On(n);t.onSubmit((0,m.Z)({payload:d},l))}else console.log("Save graph data which are from server."),t.onSubmit((0,m.Z)({payload:t.payload},l))},r=function(l){console.log("Failed:",l),K.ZP.error("Failed to submit graph")};return(0,e.jsx)(st.Z,{className:"graph-form",title:"Save the current graph",open:t.visible,footer:null,width:500,closable:!0,onCancel:t.onClose,destroyOnClose:!0,getContainer:t.parent?t.parent:document.body,children:(0,e.jsxs)(ce.Z,{name:"basic",labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},onFinish:o,onFinishFailed:r,autoComplete:"off",children:[(0,e.jsx)(ce.Z.Item,{label:"name",name:"name",rules:[{required:!0,message:"Please input a graph name!"}],children:(0,e.jsx)(Ft.Z,{placeholder:"Please input a graph name"})}),(0,e.jsx)(ce.Z.Item,{label:"description",name:"description",rules:[{required:!1,message:"Please input description!"}],children:(0,e.jsx)(ci.Z,{rows:5,placeholder:"Please input description!"})}),(0,e.jsx)(ce.Z.Item,{wrapperCol:{offset:20,span:4},children:(0,e.jsx)(W.Z,{type:"primary",htmlType:"submit",children:"Submit"})})]})})},fi=ui,hi=function(t){for(var a="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=n.length,r=0;r<t;)a+=n.charAt(Math.floor(Math.random()*o)),r+=1;return a},vi=function(t){var a=(0,s.useContext)(pn),n=t.data,o=(0,s.useState)([]),r=(0,y.Z)(o,2),i=r[0],l=r[1],d=(0,s.useState)(hi(5)),f=(0,y.Z)(d,2),x=f[0],S=f[1];(0,s.useEffect)(function(){var v=[];if(a.selectedNodes){var b;console.log("graphinContext.selectedNodes: ",a.selectedNodes),v=(b=a.selectedNodes)===null||b===void 0?void 0:b.map(function(k){return k.data.id})}if(n.length!==0){var g=[],Z=[],E={};n.forEach(function(k){E[k.nlabel]?E[k.nlabel].push(k):E[k.nlabel]=[k]}),Object.keys(E).forEach(function(k){var D=E[k],C=D.map(function(L){return L.x}),O=D.map(function(L){return L.y}),_=D.map(function(L){return L.nlabel}),M=[];v?M=D.map(function(L){return console.log("item.data.id: ",L.data.id,v),v.includes(L.data.id)?L.data.name:""}):M=D.map(function(L){return L.data.name});var I=D.map(function(L){return L.data.id});Z.push({x:C,y:O,type:"scatter",mode:"markers+text",textposition:"bottom center",text:M,customdata:D,name:_[0],extra:I,marker:{color:D[0].style.keyshape.fill,size:10},hovertemplate:"<b>%{customdata.data.name}</b><br>%{customdata.data.id}<br>%{yaxis.title.text}: %{y}<br>%{xaxis.title.text}: %{x}<br><extra></extra>",texttemplate:"%{text}"})}),g.push({data:Z,layout:Ke("","X","Y",!1)}),console.log("localCharts: ",g),l(g)}},[n,a.selectedNodes]);var j=function(b){if(b.points.length===1){var g=b.points[0];g.customdata&&t.onClick&&t.onClick(g.customdata)}else console.log("onPlotlyClick: ",b),K.ZP.info("Please click one node to focus.")};return(0,e.jsxs)(q.Z,{className:"complex-chart",children:[t.description?(0,e.jsx)("span",{className:"notice",children:t.description}):null,i.length===0?(0,e.jsx)(be.Z,{span:24,children:(0,e.jsx)(Ee.Z,{})}):i.map(function(v,b){return(0,e.jsx)(be.Z,{span:24,style:{height:"400px"},children:(0,e.jsx)(Ut,{mode:"Plotly",plotlyData:v,divId:"".concat(x),onClick:j,forceResize:!0})},b)})]})},pi=vi,gi=["source","target"],mi={backgroundImage:"url(".concat(window.publicPath+"graph-background.png",")")},yi=function(t,a){var n=new Map;t.forEach(function(r){var i=r.source,l=r.target,d="".concat(i,"-").concat(l);if(n.has(d)){var f=n.get(d);f&&n.set(d,[].concat((0,de.Z)(f),[r]))}else n.set(d,[r])});var o=[];return n.forEach(function(r,i){if(r.length>1){var l=(0,y.Z)(r,1),d=l[0],f=d.source,x=d.target,S=(0,Et.Z)(d,gi),j=r.map(function(v){return v.reltype});o.push((0,m.Z)((0,m.Z)({source:f,target:x},S),{},{reltype:j.join("|"),relid:"MultipleLabels-".concat(f,"-").concat(x),style:(0,m.Z)((0,m.Z)({},S.style),{},{label:{value:"MultipleLabels"}}),data:(0,m.Z)((0,m.Z)({},S.data),{},{identity:"MultipleLabels-".concat(f,"-").concat(x),reltypes:j})}))}else o.push(r[0])}),o},xi=function(t){var a=st.Z.useModal(),n=(0,y.Z)(a,2),o=n[0],r=n[1],i=(0,s.useState)({nodes:[],edges:[]}),l=(0,y.Z)(i,2),d=l[0],f=l[1],x=(0,s.useState)([]),S=(0,y.Z)(x,2),j=S[0],v=S[1],b=(0,s.useState)([]),g=(0,y.Z)(b,2),Z=g[0],E=g[1],k=(0,s.useState)([]),D=(0,y.Z)(k,2),C=D[0],O=D[1],_=(0,s.useState)([]),M=(0,y.Z)(_,2),I=M[0],L=M[1],B=(0,s.useState)([]),U=(0,y.Z)(B,2),$=U[0],se=U[1],Se=(0,s.useState)(!1),ue=(0,y.Z)(Se,2),G=ue[0],Y=ue[1],ye=(0,s.useState)(!1),ge=(0,y.Z)(ye,2),Ne=ge[0],fe=ge[1],ie=(0,s.useState)([]),Le=(0,y.Z)(ie,2),ke=Le[0],ze=Le[1],R=(0,s.useState)([]),_e=(0,y.Z)(R,2),J=_e[0],Q=_e[1],X=(0,s.useState)(!1),T=(0,y.Z)(X,2),p=T[0],h=T[1],w=(0,s.useState)(void 0),F=(0,y.Z)(w,2),z=F[0],te=F[1],re=(0,s.useState)(!1),he=(0,y.Z)(re,2),Re=he[0],Ve=he[1],De=(0,s.useState)(void 0),Ye=(0,y.Z)(De,2),Me=Ye[0],Ae=Ye[1],qt=(0,s.useState)(!1),ht=(0,y.Z)(qt,2),ki=ht[0],en=ht[1],wi=(0,s.useState)([]),Jn=(0,y.Z)(wi,2),Ei=Jn[0],Xn=Jn[1],Pi=(0,s.useState)("activate"),qn=(0,y.Z)(Pi,2),Ii=qn[0],ea=qn[1],Ti=(0,s.useState)(""),ta=(0,y.Z)(Ti,2),Di=ta[0],tn=ta[1],Mi=(0,s.useState)([]),na=(0,y.Z)(Mi,2),Gi=na[0],Oi=na[1],Li=(0,s.useState)(!1),aa=(0,y.Z)(Li,2),nn=aa[0],ra=aa[1],Ri=(0,s.useState)({node_type:"",node_id:"",nsteps:1,merge_mode:"replace",enable_prediction:!1,limit:50}),oa=(0,y.Z)(Ri,2),Ge=oa[0],vt=oa[1],Ai=s.useState(qa),ia=(0,y.Z)(Ai,2),la=ia[0],sa=ia[1],Fi=(0,s.useState)("New Graph"),da=(0,y.Z)(Fi,2),an=da[0],ca=da[1],zi=(0,s.useState)("New Graph"),ua=(0,y.Z)(zi,2),rn=ua[0],fa=ua[1],Vi=(0,s.useState)(!1),ha=(0,y.Z)(Vi,2),va=ha[0],on=ha[1],Bi=(0,s.useState)([]),pa=(0,y.Z)(Bi,2),Ui=pa[0],Wi=pa[1],Ki=(0,s.useState)(!1),ga=(0,y.Z)(Ki,2),Hi=ga[0],ln=ga[1],$i=(0,s.useState)(!1),ma=(0,y.Z)($i,2),Qi=ma[0],sn=ma[1],_i=(0,s.useState)({}),ya=(0,y.Z)(_i,2),Yi=ya[0],Ji=ya[1],Je=function(P){var A=new Set(P.nodes.map(function(ae){return ae.id})),ne=P.edges.filter(function(ae){return!A.has(ae.source)||!A.has(ae.target)}),pe=P.edges.filter(function(ae){return A.has(ae.source)&&A.has(ae.target)});on(!0),f({nodes:P.nodes,edges:yi(pe,{})})},Xi=function(){f({nodes:[],edges:[]}),ca(""),fa("")},qi=function(P,A){return(0,e.jsxs)("span",{children:[P?(0,e.jsx)(Oe.Z,{color:"#f50",children:"dirty"}):(0,e.jsx)(Oe.Z,{color:"#87d068",children:"cleaned"}),"\xA0",A]})};(0,s.useEffect)(function(){var V=Cn(d.nodes);O(V);var P=bn(V,["comboId","style","data"]);E(P);var A=Cn(d.edges);se(A);var ne=bn(A,[]);L(ne),console.log("Node & Edge Columns: ",P,ne),v([[(0,e.jsxs)("span",{children:["Nodes ",(0,e.jsx)(Oe.Z,{color:"#2db7f5",children:"Canvas"})]}),d.nodes.length],[(0,e.jsxs)("span",{children:["Edges ",(0,e.jsx)(Oe.Z,{color:"#2db7f5",children:"Canvas"})]}),d.edges.length],[(0,e.jsxs)("span",{children:["Nodes ",(0,e.jsx)(Oe.Z,{color:"#108ee9",children:"KGraph"})]}),ke.reduce(function(pe,ae){return pe+ae.node_count},0).toLocaleString()],[(0,e.jsxs)("span",{children:["Edges ",(0,e.jsx)(Oe.Z,{color:"#108ee9",children:"KGraph"})]}),J.reduce(function(pe,ae){return pe+ae.relation_count},0).toLocaleString()],[(0,e.jsxs)("span",{children:["Status ",(0,e.jsx)(Oe.Z,{color:"#2db7f5",children:"Canvas"})]}),qi(va,rn)]])},[d,J,ke,rn]);var dn=function(){(0,Ce.Nx)({page:1,page_size:100}).then(function(P){Wi(P.data)}).catch(function(P){console.log(P),K.ZP.error("Failed to get graphs, please check the network connection.")})},xa=function(P,A){var ne=P.payload;ne&&(on(!1),ca(A.id),fa(P.id),Je(ne.data),sa(ne.layout),Y(ne.toolbarVisible),ln(!1))},el=function(P,A){console.log("Load graph: ",P,A),va?o.confirm({title:"You have unsaved changes",icon:(0,e.jsx)(fn.Z,{}),content:"Are you sure to load another graph?",okText:"Load",cancelText:"Cancel",onOk:function(){on(!1),xa(P,A)},onCancel:function(){}}):xa(P,A)},tl=function(P){(0,Ce.in)({id:P.id}).then(function(A){K.ZP.success("Graph deleted successfully."),dn()}).catch(function(A){console.log(A),K.ZP.error("Failed to delete graph, please check the network connection.")})};(0,s.useEffect)(function(){(0,Ce.aC)().then(function(V){ze(V.node_stat),Q(V.relationship_stat)}).catch(function(V){console.log(V),K.ZP.error("Failed to get statistics, please check the network connection.")}),dn()},[]),(0,s.useEffect)(function(){nn===!1&&_a(Ge)?(fe(!0),K.ZP.info("Loading data, please wait..."),Ya(Ge).then(function(V){if(console.log("Query Graph Response: ",V),Ge.merge_mode=="replace")Je(V);else if(Ge.merge_mode=="append")Je({nodes:(0,N.uniqBy)([].concat((0,de.Z)(d.nodes),(0,de.Z)(V.nodes)),"id"),edges:(0,N.uniqBy)([].concat((0,de.Z)(d.edges),(0,de.Z)(V.edges)),"relid")});else if(Ge.merge_mode=="subtract"){var P=V.nodes,A=V.edges,ne=P.map(function(Ie){return Ie.id});ne=ne.filter(function(Ie){var pt=function(it,mt,yt){return(it.target==mt||it.source==mt)&&yt.indexOf(it.reltype)>-1},ot=Ge.relation_types||A.map(function(Be){return Be.reltype}),gt=d.edges.filter(function(Be){return pt(Be,Ie,ot)});return console.log("Found: ",gt,Ie,ot),gt.length<2});var pe=d.nodes.filter(function(Ie){return!ne.includes(Ie.id)}),ae=d.edges.filter(function(Ie){return!ne.includes(Ie.source)&&!ne.includes(Ie.target)}),Xe={nodes:pe,edges:ae};console.log("New Data: ",Xe,d,V,ne),Je(Xe)}else K.ZP.warn("Unknown merge mode, please retry later.");K.ZP.success("Find ".concat(V.nodes.length," entities and ").concat(V.edges.length," relationships.")),fe(!1)}).catch(function(V){console.log("getNodes Error: ",V),K.ZP.warn("Unknown errors or Cannot find any entities & relationships."),fe(!1)})):console.log("Advanced Search Panel is active or search object is invalid: ",nn,Ge)},[Ge]);var cn=function(){ra(!0)},Sa=function(){ra(!1)},nl=function(P){console.log("Search Object: ",P),Sa(),vt(P)},al=function(P,A){vt({mode:"node",node_type:P,node_id:A,merge_mode:"replace",nsteps:1,limit:50,enable_prediction:!1})},rl=function(P,A,ne){if(P.key=="auto-connect"){K.ZP.info("Auto connecting nodes, please wait..."),fe(!0);var pe=A.getNodes().map(function(ae){return ae.getModel()});$a(pe).then(function(ae){console.log("Auto Connect Response: ",ae),Je({nodes:(0,N.uniqBy)([].concat((0,de.Z)(d.nodes),(0,de.Z)(ae.nodes)),"id"),edges:(0,N.uniqBy)([].concat((0,de.Z)(d.edges),(0,de.Z)(ae.edges)),"relid")}),ae.nodes.length==0&&ae.edges.length==0?K.ZP.warn("No more relationships can be found."):K.ZP.success("Find ".concat(ae.nodes.length," entities and ").concat(ae.edges.length," relationships."))}).catch(function(ae){console.log("Auto Connect Error: ",ae),K.ZP.warn("Something went wrong, please try again later.")}).finally(function(){fe(!1)})}},ol=function(P,A,ne,pe,ae,Xe){P.key=="what-is-the-relationship"?t.postMessage&&t.postMessage("what is the relationship between ".concat(A.data.name," and ").concat(ne.data.name,"?")):P.key=="show-edge-details"&&(Ve(!0),Ae({startNode:A,endNode:ne,edge:pe}))},il=function(P,A,ne,pe){if(console.log("onNodeMenuClick [".concat(P.key,"]: "),P,A),P.key=="delete-nodes"){var ae=At(ne),Xe=(0,de.Z)(ae.map(function(oe){return oe.id}));if(ae.length==0){K.ZP.info("Please select one or more nodes to delete.");return}else K.ZP.info("Deleting ".concat(ae.length," nodes, please wait...")),ae.forEach(function(oe){ne.removeItem(oe.id)}),Je({nodes:d.nodes.filter(function(oe){return!Xe.includes(oe.id)}),edges:d.edges.filter(function(oe){return!Xe.includes(oe.source)&&!Xe.includes(oe.target)})})}else if(P.key=="expand-one-level")cn(),vt({node_type:A.nlabel,node_id:A.data.id,merge_mode:"append"});else if(["expand-all-paths-1","expand-all-paths-2","expand-all-paths-3"].includes(P.key)){console.log("Expand All Paths: ",P.key);var Ie=At(ne);if(Ie.length==0){K.ZP.info("Please select one or more nodes to expand.");return}else vt({nodes:Ie,merge_mode:"append",mode:"path",nsteps:parseInt(P.key.split("-").pop()||"1"),limit:50})}else if(P.key=="expand-selected-nodes"){var pt=At(ne);pt.length==0&&A&&pt.push(A),cn(),vt({nodes:pt,merge_mode:"append",mode:"batchNodes",node_id:"",node_type:""})}else if(P.key=="what-is-the-node")t.postMessage&&t.postMessage("what is the ".concat(A.data.name,"?"));else if(P.key=="predict-relationships"){var ot="".concat(A.nlabel,"::").concat(A.data.id),gt=At(ne),Be=gt.map(function(oe){return"".concat(oe.nlabel,"::").concat(oe.data.id)});Be=Be.filter(function(oe){return oe!=ot}),console.log("Predict Relationships: ",P,ot,Be,gt),Ja(ot,Be).then(function(oe){console.log("Predict Relationships Response: ",oe),oe.nodes.length==0&&oe.edges.length==0?K.ZP.warn("No more relationships can be found."):Je({nodes:(0,N.uniqBy)([].concat((0,de.Z)(d.nodes),(0,de.Z)(oe.nodes)),"id"),edges:(0,N.uniqBy)([].concat((0,de.Z)(d.edges),(0,de.Z)(oe.edges)),"relid")})}).catch(function(oe){console.log("Predict Relationships Error: ",oe),K.ZP.warn("Something went wrong, please try again later.")})}else if(P.key=="visulize-similarities"){var it=nr(ne),mt=A.nlabel,yt=A.data.id,Ca=it.filter(function(oe){return oe.data.id!=yt}),ja=Ca.map(function(oe){return oe.nlabel}),Na=Ca.map(function(oe){return oe.data.id});fe(!0),Xa(yt,mt,Na,ja).then(function(oe){console.log("Get Dimensions Response: ",oe,Na,ja,yt,mt);var hl=oe.map(function(lt){var ka=it.filter(function(wa){return wa.data.id==lt.node_id&&wa.nlabel==lt.node_type});return ka.length>0?(0,m.Z)((0,m.Z)({},ka[0]),{},{x:lt.x,y:lt.y}):{}}).filter(function(lt){return Object.keys(lt).length>0});Xn(hl),en(!0),fe(!1)}).catch(function(oe){console.log("Get Dimensions Error: ",oe),Xn([]),en(!1),K.ZP.error("Failed to get similarities, please check the network connection."),fe(!1)}).finally(function(){fe(!1)})}else P.key=="show-node-details"&&(h(!0),te(A))},ll={selectedRowKeys:Gi},sl=function(P){var A=s.Children.count(P.children),ne=s.Children.toArray(P.children),pe=[{label:"Nodes",key:"nodes",children:A>=2?ne[0]:"No Content"},{label:"Edges",key:"edges",children:A>=2?ne[1]:"No Content"}];return(0,e.jsx)(ve.Z,{className:"tabs-nav-center",children:pe.map(function(ae){return(0,e.jsx)(ve.Z.TabPane,{tab:ae.label,children:ae.children},ae.key)})})},dl=function(){sn(!0),Ji({data:d,layout:la,toolbarVisible:G})},cl=function(){Y(!G)},ul=function(P,A){console.log("Node Clicked: ",P,d,A),A&&(h(!0),te(A))},fl=function(P,A,ne,pe){console.log("Edge Clicked: ",P),P&&(Ve(!0),Ae({edge:pe,startNode:A,endNode:ne}))},Za=function(){Ve(!1),h(!1)},rt=(0,et.r)(),ba=function(P){return new Promise(function(A,ne){an&&tr(an)&&(P=(0,m.Z)((0,m.Z)({},P),{},{parent:an})),delete P.id,(0,Ce.xD)(P).then(function(pe){return K.ZP.success("Graph data saved."),dn(),A(pe)}).catch(function(pe){return console.log("Post Graphs Error: ",pe),K.ZP.error("Graph save failed."),ne(pe)})})};return(0,e.jsx)(et.I,{handle:rt,children:(0,e.jsx)(q.Z,{className:"knowledge-graph-container",id:"knowledge-graph-container",children:(0,e.jsxs)(Ht.Z,{spinning:Ne,children:[(0,e.jsxs)(q.Z,{className:"left-toolbar",children:[(0,e.jsx)(qe.Z,{title:rt.active?"Exit Full Screen":"Enter Full Screen",placement:"right",children:(0,e.jsx)(W.Z,{className:"full-screen-button",onClick:rt.active?rt.exit:rt.enter,shape:"circle",icon:rt.active?(0,e.jsx)(dt.Z,{}):(0,e.jsx)(Pt.Z,{})})}),(0,e.jsx)(qe.Z,{title:G?"Hide Toolbar":"Show Toolbar",placement:"right",children:(0,e.jsx)(W.Z,{className:"toolbar-button",onClick:cl,shape:"circle",icon:G?(0,e.jsx)(tt.Z,{}):(0,e.jsx)($t.Z,{})})}),(0,e.jsx)(qe.Z,{title:"Save Graph Data",placement:"right",children:(0,e.jsx)(W.Z,{className:"save-button",onClick:dl,shape:"circle",icon:(0,e.jsx)(ct.Z,{})})}),(0,e.jsx)(qe.Z,{title:"Load Graph Data",placement:"right",children:(0,e.jsx)(W.Z,{className:"clear-button",onClick:function(){ln(!0)},shape:"circle",icon:(0,e.jsx)(It.Z,{})})})]}),(0,e.jsxs)(q.Z,{className:"top-toolbar",children:[(0,e.jsx)(Rr,{onChange:al,onAdvancedSearch:cn}),(0,e.jsx)(io,{onOk:nl,visible:nn,onCancel:Sa,searchObject:Ge,edgeStat:J,parent:document.getElementById("knowledge-graph-container")},Ge.node_id)]}),(0,e.jsxs)(be.Z,{className:"graphin",style:{width:"100%",height:"100%",position:"relative"},children:[(0,e.jsx)(ee,{position:"top",width:"300px",height:"100%",closable:!0,title:"Statistics",children:(0,e.jsx)(yo,{nodeStat:ke,edgeStat:J})}),(0,e.jsx)(ee,{position:"left",width:"60%",title:"Charts",closable:!0,children:(0,e.jsx)(po,{data:d})}),(0,e.jsx)(ee,{position:"right",width:"80%",closable:!1,maskVisible:!0,visible:p,onClose:Za,children:z?(0,e.jsx)(Qo,{node:z}):(0,e.jsx)(Ee.Z,{description:"No node selected"})}),(0,e.jsx)(ee,{position:"right",width:"80%",closable:!1,maskVisible:!0,visible:Re,onClose:Za,children:Me?(0,e.jsx)(ni,{edgeInfo:Me}):(0,e.jsx)(Ee.Z,{description:"No edge selected"})}),(0,e.jsx)(ee,{position:"bottom",width:"300px",height:"300px",onClick:function(){tn("")},children:(0,e.jsxs)(sl,{children:[Z.length>0?(0,e.jsx)(He.Z,{size:"small",scroll:{y:200},rowKey:"identity",dataSource:C,columns:Z,pagination:!1,onRow:function(P,A){return{onClick:function(pe){console.log("Click the node item: ",pe,P),tn(P.identity),Oi([P.identity])}}},rowSelection:(0,m.Z)({type:"radio"},ll)}):null,Z.length>0?(0,e.jsx)(He.Z,{size:"small",scroll:{y:200},rowKey:"id",dataSource:$,columns:I,pagination:!1}):null]})}),(0,e.jsxs)(Or,{selectedNode:Di,highlightMode:Ii,data:d,layout:la,style:mi,queriedId:Ge.node_id,statistics:j,toolbarVisible:G,onClearGraph:Xi,onEdgeMenuClick:ol,chatbotVisible:!!t.postMessage,onClickNode:ul,onClickEdge:fl,onCanvasMenuClick:rl,changeLayout:function(P){sa(P)},onNodeMenuClick:il,children:[ki?(0,e.jsx)(Gt,{onClose:function(){en(!1),ea("activate")},width:"600px",title:"Node Similarity [t-SNE]",children:(0,e.jsx)(pi,{data:Ei,description:'If you expect to highlight nodes on the chart, you need to enable the "Focus" and "Select" mode.',onClick:function(P){tn(P.id),ea("focus")}})}):null,(0,e.jsx)(di,{visible:Hi,graphs:Ui,onLoad:el,onDelete:tl,treeFormat:!0,parent:document.getElementById("knowledge-graph-container"),onClose:function(){ln(!1)},onUpload:function(P){ba(P)},selectedGraphId:rn}),(0,e.jsx)(fi,{visible:Qi,payload:Yi,parent:document.getElementById("knowledge-graph-container"),onClose:function(){sn(!1)},onSubmit:function(P){ba(P).finally(function(){sn(!1)})}})]}),r]})]})})})},Si=xi,Zi=u(75491),bi=u(41935),Yn=24,Ci=16,ji=function(){var t=(0,s.useState)(""),a=(0,y.Z)(t,2),n=a[0],o=a[1],r=(0,s.useState)(!1),i=(0,y.Z)(r,2),l=i[0],d=i[1],f=(0,s.useState)(Yn),x=(0,y.Z)(f,2),S=x[0],j=x[1];return(0,s.useEffect)(function(){j(l?Ci:Yn)},[l]),(0,e.jsxs)(q.Z,{gutter:8,className:"chat-ai-container",children:[l?(0,e.jsx)(be.Z,{xxl:24-S,xl:24-S,lg:24-S,md:24,sm:24,xs:24,children:(0,e.jsx)(Kt.Z,{message:n})}):null,(0,e.jsxs)(be.Z,{xxl:S,xl:S,lg:S,md:24,sm:24,xs:24,children:[(0,e.jsx)(W.Z,{shape:"circle",className:"chat-button",onClick:function(){d(!l)},icon:l?(0,e.jsx)(Zi.Z,{}):(0,e.jsx)(bi.Z,{})}),(0,e.jsx)(Si,{postMessage:function(b){o(b)}})]})]})},Ni=ji},67569:function(Ea,xt,u){"use strict";u.d(xt,{jN:function(){return Kt},Nx:function(){return Ht},xD:function(){return He},in:function(){return qe},ix:function(){return ve},$7:function(){return K},g7:function(){return Oe},zX:function(){return Et},zV:function(){return s},mc:function(){return Pt},aU:function(){return $t},aC:function(){return It}});var un=u(93224),q=u(39428),xe=u(11849),W=u(3182),we=u(74310),be=null,y=["id"];function Kt(H,e){return St.apply(this,arguments)}function St(){return St=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/dimension",(0,xe.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:e},le||{})));case 1:case"end":return N.stop()}},H)})),St.apply(this,arguments)}function Ht(H,e){return Zt.apply(this,arguments)}function Zt(){return Zt=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/graphs",(0,xe.Z)({method:"GET",params:(0,xe.Z)({},e)},le||{})));case 1:case"end":return N.stop()}},H)})),Zt.apply(this,arguments)}function He(H,e){return bt.apply(this,arguments)}function bt(){return bt=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/graphs",(0,xe.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:e},le||{})));case 1:case"end":return N.stop()}},H)})),bt.apply(this,arguments)}function Ee(H,e){return Ct.apply(this,arguments)}function Ct(){return Ct=_asyncToGenerator(_regeneratorRuntime().mark(function H(e,le){var ee,N;return _regeneratorRuntime().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return ee=e.id,N=_objectWithoutProperties(e,be),me.abrupt("return",request("/api/v1/graphs/".concat(ee),_objectSpread({method:"GET",params:_objectSpread({},N)},le||{})));case 2:case"end":return me.stop()}},H)})),Ct.apply(this,arguments)}function qe(H,e){return jt.apply(this,arguments)}function jt(){return jt=(0,W.Z)((0,q.Z)().mark(function H(e,le){var ee,N;return(0,q.Z)().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return ee=e.id,N=(0,un.Z)(e,y),me.abrupt("return",(0,we.WY)("/api/v1/graphs/".concat(ee),(0,xe.Z)({method:"DELETE",params:(0,xe.Z)({},N)},le||{})));case 2:case"end":return me.stop()}},H)})),jt.apply(this,arguments)}function ve(H,e){return Nt.apply(this,arguments)}function Nt(){return Nt=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/knowledges",(0,xe.Z)({method:"GET",params:(0,xe.Z)({},e)},le||{})));case 1:case"end":return N.stop()}},H)})),Nt.apply(this,arguments)}function K(H,e){return kt.apply(this,arguments)}function kt(){return kt=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/knowledges",(0,xe.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:e},le||{})));case 1:case"end":return N.stop()}},H)})),kt.apply(this,arguments)}function Oe(H,e){return wt.apply(this,arguments)}function wt(){return wt=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/labels",(0,xe.Z)({method:"GET",params:(0,xe.Z)({},e)},le||{})));case 1:case"end":return N.stop()}},H)})),wt.apply(this,arguments)}function st(H,e){return m.apply(this,arguments)}function m(){return m=_asyncToGenerator(_regeneratorRuntime().mark(function H(e,le){return _regeneratorRuntime().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",request("/api/v1/node-properties",_objectSpread({method:"GET",params:_objectSpread({},e)},le||{})));case 1:case"end":return N.stop()}},H)})),m.apply(this,arguments)}function Et(H){return de.apply(this,arguments)}function de(){return de=(0,W.Z)((0,q.Z)().mark(function H(e){return(0,q.Z)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.abrupt("return",(0,we.WY)("/api/v1/node-types",(0,xe.Z)({method:"GET"},e||{})));case 1:case"end":return ee.stop()}},H)})),de.apply(this,arguments)}function s(H,e){return et.apply(this,arguments)}function et(){return et=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/nodes",(0,xe.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:e},le||{})));case 1:case"end":return N.stop()}},H)})),et.apply(this,arguments)}function fn(H){return dt.apply(this,arguments)}function dt(){return dt=_asyncToGenerator(_regeneratorRuntime().mark(function H(e){return _regeneratorRuntime().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.abrupt("return",request("/api/v1/relationship-types",_objectSpread({method:"GET"},e||{})));case 1:case"end":return ee.stop()}},H)})),dt.apply(this,arguments)}function Pt(H,e){return tt.apply(this,arguments)}function tt(){return tt=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/relationships",(0,xe.Z)({method:"GET",params:(0,xe.Z)({},e)},le||{})));case 1:case"end":return N.stop()}},H)})),tt.apply(this,arguments)}function $t(H,e){return ct.apply(this,arguments)}function ct(){return ct=(0,W.Z)((0,q.Z)().mark(function H(e,le){return(0,q.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",(0,we.WY)("/api/v1/similarity",(0,xe.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:e},le||{})));case 1:case"end":return N.stop()}},H)})),ct.apply(this,arguments)}function It(H){return Tt.apply(this,arguments)}function Tt(){return Tt=(0,W.Z)((0,q.Z)().mark(function H(e){return(0,q.Z)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.abrupt("return",(0,we.WY)("/api/v1/statistics",(0,xe.Z)({method:"GET"},e||{})));case 1:case"end":return ee.stop()}},H)})),Tt.apply(this,arguments)}},75410:function(){},48628:function(){},31601:function(){},67792:function(){},75042:function(){}}]);
